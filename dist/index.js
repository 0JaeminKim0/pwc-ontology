var Ia=Object.defineProperty;var Qt=e=>{throw TypeError(e)};var Ta=(e,t,r)=>t in e?Ia(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var w=(e,t,r)=>Ta(e,typeof t!="symbol"?t+"":t,r),Rt=(e,t,r)=>t.has(e)||Qt("Cannot "+r);var u=(e,t,r)=>(Rt(e,t,"read from private field"),r?r.call(e):t.get(e)),b=(e,t,r)=>t.has(e)?Qt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),x=(e,t,r,a)=>(Rt(e,t,"write to private field"),a?a.call(e,r):t.set(e,r),r),S=(e,t,r)=>(Rt(e,t,"access private method"),r);var er=(e,t,r,a)=>({set _(s){x(e,t,s,r)},get _(){return u(e,t,a)}});import{existsSync as ka,lstatSync as Oa,createReadStream as tr}from"fs";import{join as rr}from"path";import{createServer as Ma}from"http";import{Http2ServerRequest as nt}from"http2";import{Readable as ar}from"stream";import ja from"crypto";var Nr={Stringify:1},L=(e,t)=>{const r=new String(e);return r.isEscaped=!0,r.callbacks=t,r},$a=/[&<>'"]/,_r=async(e,t)=>{let r="";t||(t=[]);const a=await Promise.all(e);for(let s=a.length-1;r+=a[s],s--,!(s<0);s--){let i=a[s];typeof i=="object"&&t.push(...i.callbacks||[]);const n=i.isEscaped;if(i=await(typeof i=="object"?i.toString():i),typeof i=="object"&&t.push(...i.callbacks||[]),i.isEscaped??n)r+=i;else{const l=[r];ne(i,l),r=l[0]}}return L(r,t)},ne=(e,t)=>{const r=e.search($a);if(r===-1){t[0]+=e;return}let a,s,i=0;for(s=r;s<e.length;s++){switch(e.charCodeAt(s)){case 34:a="&quot;";break;case 39:a="&#39;";break;case 38:a="&amp;";break;case 60:a="&lt;";break;case 62:a="&gt;";break;default:continue}t[0]+=e.substring(i,s)+a,i=s+1}t[0]+=e.substring(i,s)},Lr=e=>{const t=e.callbacks;if(!(t!=null&&t.length))return e;const r=[e],a={};return t.forEach(s=>s({phase:Nr.Stringify,buffer:r,context:a})),r[0]},zr=async(e,t,r,a,s)=>{typeof e=="object"&&!(e instanceof String)&&(e instanceof Promise||(e=e.toString()),e instanceof Promise&&(e=await e));const i=e.callbacks;return i!=null&&i.length?(s?s[0]+=e:s=[e],Promise.all(i.map(l=>l({phase:t,buffer:s,context:a}))).then(l=>Promise.all(l.filter(Boolean).map(o=>zr(o,t,!1,a,s))).then(()=>s[0]))):Promise.resolve(e)},Da=(e,...t)=>{const r=[""];for(let a=0,s=e.length-1;a<s;a++){r[0]+=e[a];const i=Array.isArray(t[a])?t[a].flat(1/0):[t[a]];for(let n=0,l=i.length;n<l;n++){const o=i[n];if(typeof o=="string")ne(o,r);else if(typeof o=="number")r[0]+=o;else{if(typeof o=="boolean"||o===null||o===void 0)continue;if(typeof o=="object"&&o.isEscaped)if(o.callbacks)r.unshift("",o);else{const c=o.toString();c instanceof Promise?r.unshift("",c):r[0]+=c}else o instanceof Promise?r.unshift("",o):ne(o.toString(),r)}}}return r[0]+=e.at(-1),r.length===1?"callbacks"in r?L(Lr(L(r[0],r.callbacks))):L(r[0]):_r(r,r.callbacks)},Bt=Symbol("RENDERER"),Nt=Symbol("ERROR_HANDLER"),I=Symbol("STASH"),Hr=Symbol("INTERNAL"),Na=Symbol("MEMO"),yt=Symbol("PERMALINK"),sr=e=>(e[Hr]=!0,e),qr=e=>({value:t,children:r})=>{if(!r)return;const a={children:[{tag:sr(()=>{e.push(t)}),props:{}}]};Array.isArray(r)?a.children.push(...r.flat()):a.children.push(r),a.children.push({tag:sr(()=>{e.pop()}),props:{}});const s={tag:"",props:a,type:""};return s[Nt]=i=>{throw e.pop(),i},s},Fr=e=>{const t=[e],r=qr(t);return r.values=t,r.Provider=r,ke.push(r),r},ke=[],Wt=e=>{const t=[e],r=a=>{t.push(a.value);let s;try{s=a.children?(Array.isArray(a.children)?new Gr("",{},a.children):a.children).toString():""}finally{t.pop()}return s instanceof Promise?s.then(i=>L(i,i.callbacks)):L(s)};return r.values=t,r.Provider=r,r[Bt]=qr(t),ke.push(r),r},$e=e=>e.values.at(-1),ot={title:[],script:["src"],style:["data-href"],link:["href"],meta:["name","httpEquiv","charset","itemProp"]},_t={},lt="data-precedence",Je=e=>Array.isArray(e)?e:[e],ir=new WeakMap,nr=(e,t,r,a)=>({buffer:s,context:i})=>{if(!s)return;const n=ir.get(i)||{};ir.set(i,n);const l=n[e]||(n[e]=[]);let o=!1;const c=ot[e];if(c.length>0){e:for(const[,d]of l)for(const h of c)if(((d==null?void 0:d[h])??null)===(r==null?void 0:r[h])){o=!0;break e}}if(o?s[0]=s[0].replaceAll(t,""):c.length>0?l.push([t,r,a]):l.unshift([t,r,a]),s[0].indexOf("</head>")!==-1){let d;if(a===void 0)d=l.map(([h])=>h);else{const h=[];d=l.map(([f,,g])=>{let m=h.indexOf(g);return m===-1&&(h.push(g),m=h.length-1),[f,m]}).sort((f,g)=>f[1]-g[1]).map(([f])=>f)}d.forEach(h=>{s[0]=s[0].replaceAll(h,"")}),s[0]=s[0].replace(/(?=<\/head>)/,d.join(""))}},Ye=(e,t,r)=>L(new F(e,r,Je(t??[])).toString()),Qe=(e,t,r,a)=>{if("itemProp"in r)return Ye(e,t,r);let{precedence:s,blocking:i,...n}=r;s=a?s??"":void 0,a&&(n[lt]=s);const l=new F(e,n,Je(t||[])).toString();return l instanceof Promise?l.then(o=>L(l,[...o.callbacks||[],nr(e,o,n,s)])):L(l,[nr(e,l,n,s)])},_a=({children:e,...t})=>{const r=Gt();if(r){const a=$e(r);if(a==="svg"||a==="head")return new F("title",t,Je(e??[]))}return Qe("title",e,t,!1)},La=({children:e,...t})=>{const r=Gt();return["src","async"].some(a=>!t[a])||r&&$e(r)==="head"?Ye("script",e,t):Qe("script",e,t,!1)},za=({children:e,...t})=>["href","precedence"].every(r=>r in t)?(t["data-href"]=t.href,delete t.href,Qe("style",e,t,!0)):Ye("style",e,t),Ha=({children:e,...t})=>["onLoad","onError"].some(r=>r in t)||t.rel==="stylesheet"&&(!("precedence"in t)||"disabled"in t)?Ye("link",e,t):Qe("link",e,t,"precedence"in t),qa=({children:e,...t})=>{const r=Gt();return r&&$e(r)==="head"?Ye("meta",e,t):Qe("meta",e,t,!1)},Ur=(e,{children:t,...r})=>new F(e,r,Je(t??[])),Fa=e=>(typeof e.action=="function"&&(e.action=yt in e.action?e.action[yt]:void 0),Ur("form",e)),Br=(e,t)=>(typeof t.formAction=="function"&&(t.formAction=yt in t.formAction?t.formAction[yt]:void 0),Ur(e,t)),Ua=e=>Br("input",e),Ba=e=>Br("button",e);const Et=Object.freeze(Object.defineProperty({__proto__:null,button:Ba,form:Fa,input:Ua,link:Ha,meta:qa,script:La,style:za,title:_a},Symbol.toStringTag,{value:"Module"}));var Wa=new Map([["className","class"],["htmlFor","for"],["crossOrigin","crossorigin"],["httpEquiv","http-equiv"],["itemProp","itemprop"],["fetchPriority","fetchpriority"],["noModule","nomodule"],["formAction","formaction"]]),mt=e=>Wa.get(e)||e,Wr=(e,t)=>{for(const[r,a]of Object.entries(e)){const s=r[0]==="-"||!/[A-Z]/.test(r)?r:r.replace(/[A-Z]/g,i=>`-${i.toLowerCase()}`);t(s,a==null?null:typeof a=="number"?s.match(/^(?:a|border-im|column(?:-c|s)|flex(?:$|-[^b])|grid-(?:ar|[^a])|font-w|li|or|sca|st|ta|wido|z)|ty$/)?`${a}`:`${a}px`:a)}},He=void 0,Gt=()=>He,Ga=e=>/[A-Z]/.test(e)&&e.match(/^(?:al|basel|clip(?:Path|Rule)$|co|do|fill|fl|fo|gl|let|lig|i|marker[EMS]|o|pai|pointe|sh|st[or]|text[^L]|tr|u|ve|w)/)?e.replace(/([A-Z])/g,"-$1").toLowerCase():e,Ka=["area","base","br","col","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],Va=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","download","formnovalidate","hidden","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],Kt=(e,t)=>{for(let r=0,a=e.length;r<a;r++){const s=e[r];if(typeof s=="string")ne(s,t);else{if(typeof s=="boolean"||s===null||s===void 0)continue;s instanceof F?s.toStringToBuffer(t):typeof s=="number"||s.isEscaped?t[0]+=s:s instanceof Promise?t.unshift("",s):Kt(s,t)}}},F=class{constructor(e,t,r){w(this,"tag");w(this,"props");w(this,"key");w(this,"children");w(this,"isEscaped",!0);w(this,"localContexts");this.tag=e,this.props=t,this.children=r}get type(){return this.tag}get ref(){return this.props.ref||null}toString(){var t,r;const e=[""];(t=this.localContexts)==null||t.forEach(([a,s])=>{a.values.push(s)});try{this.toStringToBuffer(e)}finally{(r=this.localContexts)==null||r.forEach(([a])=>{a.values.pop()})}return e.length===1?"callbacks"in e?Lr(L(e[0],e.callbacks)).toString():e[0]:_r(e,e.callbacks)}toStringToBuffer(e){const t=this.tag,r=this.props;let{children:a}=this;e[0]+=`<${t}`;const s=He&&$e(He)==="svg"?i=>Ga(mt(i)):i=>mt(i);for(let[i,n]of Object.entries(r))if(i=s(i),i!=="children"){if(i==="style"&&typeof n=="object"){let l="";Wr(n,(o,c)=>{c!=null&&(l+=`${l?";":""}${o}:${c}`)}),e[0]+=' style="',ne(l,e),e[0]+='"'}else if(typeof n=="string")e[0]+=` ${i}="`,ne(n,e),e[0]+='"';else if(n!=null)if(typeof n=="number"||n.isEscaped)e[0]+=` ${i}="${n}"`;else if(typeof n=="boolean"&&Va.includes(i))n&&(e[0]+=` ${i}=""`);else if(i==="dangerouslySetInnerHTML"){if(a.length>0)throw new Error("Can only set one of `children` or `props.dangerouslySetInnerHTML`.");a=[L(n.__html)]}else if(n instanceof Promise)e[0]+=` ${i}="`,e.unshift('"',n);else if(typeof n=="function"){if(!i.startsWith("on")&&i!=="ref")throw new Error(`Invalid prop '${i}' of type 'function' supplied to '${t}'.`)}else e[0]+=` ${i}="`,ne(n.toString(),e),e[0]+='"'}if(Ka.includes(t)&&a.length===0){e[0]+="/>";return}e[0]+=">",Kt(a,e),e[0]+=`</${t}>`}},St=class extends F{toStringToBuffer(e){const{children:t}=this,r=this.tag.call(null,{...this.props,children:t.length<=1?t[0]:t});if(!(typeof r=="boolean"||r==null))if(r instanceof Promise)if(ke.length===0)e.unshift("",r);else{const a=ke.map(s=>[s,s.values.at(-1)]);e.unshift("",r.then(s=>(s instanceof F&&(s.localContexts=a),s)))}else r instanceof F?r.toStringToBuffer(e):typeof r=="number"||r.isEscaped?(e[0]+=r,r.callbacks&&(e.callbacks||(e.callbacks=[]),e.callbacks.push(...r.callbacks))):ne(r,e)}},Gr=class extends F{toStringToBuffer(e){Kt(this.children,e)}},or=(e,t,...r)=>{t??(t={}),r.length&&(t.children=r.length===1?r[0]:r);const a=t.key;delete t.key;const s=ct(e,t,r);return s.key=a,s},lr=!1,ct=(e,t,r)=>{if(!lr){for(const a in _t)Et[a][Bt]=_t[a];lr=!0}return typeof e=="function"?new St(e,t,r):Et[e]?new St(Et[e],t,r):e==="svg"||e==="head"?(He||(He=Wt("")),new F(e,t,[new St(He,{value:e},r)])):new F(e,t,r)},Xa=({children:e})=>new Gr("",{children:e},Array.isArray(e)?e:e?[e]:[]);function O(e,t,r){let a;if(!t||!("children"in t))a=ct(e,t,[]);else{const s=t.children;a=Array.isArray(s)?ct(e,t,s):ct(e,t,[s])}return a.key=r,a}var cr=(e,t,r)=>(a,s)=>{let i=-1;return n(0);async function n(l){if(l<=i)throw new Error("next() called multiple times");i=l;let o,c=!1,d;if(e[l]?(d=e[l][0][0],a.req.routeIndex=l):d=l===e.length&&s||void 0,d)try{o=await d(a,()=>n(l+1))}catch(h){if(h instanceof Error&&t)a.error=h,o=await t(h,a),c=!0;else throw h}else a.finalized===!1&&r&&(o=await r(a));return o&&(a.finalized===!1||c)&&(a.res=o),a}},Za=Symbol(),Ja=async(e,t=Object.create(null))=>{const{all:r=!1,dot:a=!1}=t,i=(e instanceof Yr?e.raw.headers:e.headers).get("Content-Type");return i!=null&&i.startsWith("multipart/form-data")||i!=null&&i.startsWith("application/x-www-form-urlencoded")?Ya(e,{all:r,dot:a}):{}};async function Ya(e,t){const r=await e.formData();return r?Qa(r,t):{}}function Qa(e,t){const r=Object.create(null);return e.forEach((a,s)=>{t.all||s.endsWith("[]")?es(r,s,a):r[s]=a}),t.dot&&Object.entries(r).forEach(([a,s])=>{a.includes(".")&&(ts(r,a,s),delete r[a])}),r}var es=(e,t,r)=>{e[t]!==void 0?Array.isArray(e[t])?e[t].push(r):e[t]=[e[t],r]:t.endsWith("[]")?e[t]=[r]:e[t]=r},ts=(e,t,r)=>{let a=e;const s=t.split(".");s.forEach((i,n)=>{n===s.length-1?a[i]=r:((!a[i]||typeof a[i]!="object"||Array.isArray(a[i])||a[i]instanceof File)&&(a[i]=Object.create(null)),a=a[i])})},Kr=e=>{const t=e.split("/");return t[0]===""&&t.shift(),t},rs=e=>{const{groups:t,path:r}=as(e),a=Kr(r);return ss(a,t)},as=e=>{const t=[];return e=e.replace(/\{[^}]+\}/g,(r,a)=>{const s=`@${a}`;return t.push([s,r]),s}),{groups:t,path:e}},ss=(e,t)=>{for(let r=t.length-1;r>=0;r--){const[a]=t[r];for(let s=e.length-1;s>=0;s--)if(e[s].includes(a)){e[s]=e[s].replace(a,t[r][1]);break}}return e},at={},is=(e,t)=>{if(e==="*")return"*";const r=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){const a=`${e}#${t}`;return at[a]||(r[2]?at[a]=t&&t[0]!==":"&&t[0]!=="*"?[a,r[1],new RegExp(`^${r[2]}(?=/${t})`)]:[e,r[1],new RegExp(`^${r[2]}$`)]:at[a]=[e,r[1],!0]),at[a]}return null},Vt=(e,t)=>{try{return t(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return t(r)}catch{return r}})}},ns=e=>Vt(e,decodeURI),Vr=e=>{const t=e.url,r=t.indexOf("/",t.indexOf(":")+4);let a=r;for(;a<t.length;a++){const s=t.charCodeAt(a);if(s===37){const i=t.indexOf("?",a),n=t.slice(r,i===-1?void 0:i);return ns(n.includes("%25")?n.replace(/%25/g,"%2525"):n)}else if(s===63)break}return t.slice(r,a)},os=e=>{const t=Vr(e);return t.length>1&&t.at(-1)==="/"?t.slice(0,-1):t},xe=(e,t,...r)=>(r.length&&(t=xe(t,...r)),`${(e==null?void 0:e[0])==="/"?"":"/"}${e}${t==="/"?"":`${(e==null?void 0:e.at(-1))==="/"?"":"/"}${(t==null?void 0:t[0])==="/"?t.slice(1):t}`}`),Xr=e=>{if(e.charCodeAt(e.length-1)!==63||!e.includes(":"))return null;const t=e.split("/"),r=[];let a="";return t.forEach(s=>{if(s!==""&&!/\:/.test(s))a+="/"+s;else if(/\:/.test(s))if(/\?/.test(s)){r.length===0&&a===""?r.push("/"):r.push(a);const i=s.replace("?","");a+="/"+i,r.push(a)}else a+="/"+s}),r.filter((s,i,n)=>n.indexOf(s)===i)},Pt=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),e.indexOf("%")!==-1?Vt(e,Jr):e):e,Zr=(e,t,r)=>{let a;if(!r&&t&&!/[%+]/.test(t)){let n=e.indexOf(`?${t}`,8);for(n===-1&&(n=e.indexOf(`&${t}`,8));n!==-1;){const l=e.charCodeAt(n+t.length+1);if(l===61){const o=n+t.length+2,c=e.indexOf("&",o);return Pt(e.slice(o,c===-1?void 0:c))}else if(l==38||isNaN(l))return"";n=e.indexOf(`&${t}`,n+1)}if(a=/[%+]/.test(e),!a)return}const s={};a??(a=/[%+]/.test(e));let i=e.indexOf("?",8);for(;i!==-1;){const n=e.indexOf("&",i+1);let l=e.indexOf("=",i);l>n&&n!==-1&&(l=-1);let o=e.slice(i+1,l===-1?n===-1?void 0:n:l);if(a&&(o=Pt(o)),i=n,o==="")continue;let c;l===-1?c="":(c=e.slice(l+1,n===-1?void 0:n),a&&(c=Pt(c))),r?(s[o]&&Array.isArray(s[o])||(s[o]=[]),s[o].push(c)):s[o]??(s[o]=c)}return t?s[t]:s},ls=Zr,cs=(e,t)=>Zr(e,t,!0),Jr=decodeURIComponent,dr=e=>Vt(e,Jr),Ee,_,J,Qr,ea,Lt,ee,Cr,Yr=(Cr=class{constructor(e,t="/",r=[[]]){b(this,J);w(this,"raw");b(this,Ee);b(this,_);w(this,"routeIndex",0);w(this,"path");w(this,"bodyCache",{});b(this,ee,e=>{const{bodyCache:t,raw:r}=this,a=t[e];if(a)return a;const s=Object.keys(t)[0];return s?t[s].then(i=>(s==="json"&&(i=JSON.stringify(i)),new Response(i)[e]())):t[e]=r[e]()});this.raw=e,this.path=t,x(this,_,r),x(this,Ee,{})}param(e){return e?S(this,J,Qr).call(this,e):S(this,J,ea).call(this)}query(e){return ls(this.url,e)}queries(e){return cs(this.url,e)}header(e){if(e)return this.raw.headers.get(e)??void 0;const t={};return this.raw.headers.forEach((r,a)=>{t[a]=r}),t}async parseBody(e){var t;return(t=this.bodyCache).parsedBody??(t.parsedBody=await Ja(this,e))}json(){return u(this,ee).call(this,"text").then(e=>JSON.parse(e))}text(){return u(this,ee).call(this,"text")}arrayBuffer(){return u(this,ee).call(this,"arrayBuffer")}blob(){return u(this,ee).call(this,"blob")}formData(){return u(this,ee).call(this,"formData")}addValidatedData(e,t){u(this,Ee)[e]=t}valid(e){return u(this,Ee)[e]}get url(){return this.raw.url}get method(){return this.raw.method}get[Za](){return u(this,_)}get matchedRoutes(){return u(this,_)[0].map(([[,e]])=>e)}get routePath(){return u(this,_)[0].map(([[,e]])=>e)[this.routeIndex].path}},Ee=new WeakMap,_=new WeakMap,J=new WeakSet,Qr=function(e){const t=u(this,_)[0][this.routeIndex][1][e],r=S(this,J,Lt).call(this,t);return r?/\%/.test(r)?dr(r):r:void 0},ea=function(){const e={},t=Object.keys(u(this,_)[0][this.routeIndex][1]);for(const r of t){const a=S(this,J,Lt).call(this,u(this,_)[0][this.routeIndex][1][r]);a&&typeof a=="string"&&(e[r]=/\%/.test(a)?dr(a):a)}return e},Lt=function(e){return u(this,_)[1]?u(this,_)[1][e]:e},ee=new WeakMap,Cr),ds="text/plain; charset=UTF-8",Ct=(e,t)=>({"Content-Type":e,...t}),Be,We,G,Se,K,D,Ge,Pe,Ce,ue,Ke,Ve,te,be,Ir,fs=(Ir=class{constructor(e,t){b(this,te);b(this,Be);b(this,We);w(this,"env",{});b(this,G);w(this,"finalized",!1);w(this,"error");b(this,Se);b(this,K);b(this,D);b(this,Ge);b(this,Pe);b(this,Ce);b(this,ue);b(this,Ke);b(this,Ve);w(this,"render",(...e)=>(u(this,Pe)??x(this,Pe,t=>this.html(t)),u(this,Pe).call(this,...e)));w(this,"setLayout",e=>x(this,Ge,e));w(this,"getLayout",()=>u(this,Ge));w(this,"setRenderer",e=>{x(this,Pe,e)});w(this,"header",(e,t,r)=>{this.finalized&&x(this,D,new Response(u(this,D).body,u(this,D)));const a=u(this,D)?u(this,D).headers:u(this,ue)??x(this,ue,new Headers);t===void 0?a.delete(e):r!=null&&r.append?a.append(e,t):a.set(e,t)});w(this,"status",e=>{x(this,Se,e)});w(this,"set",(e,t)=>{u(this,G)??x(this,G,new Map),u(this,G).set(e,t)});w(this,"get",e=>u(this,G)?u(this,G).get(e):void 0);w(this,"newResponse",(...e)=>S(this,te,be).call(this,...e));w(this,"body",(e,t,r)=>S(this,te,be).call(this,e,t,r));w(this,"text",(e,t,r)=>!u(this,ue)&&!u(this,Se)&&!t&&!r&&!this.finalized?new Response(e):S(this,te,be).call(this,e,t,Ct(ds,r)));w(this,"json",(e,t,r)=>S(this,te,be).call(this,JSON.stringify(e),t,Ct("application/json",r)));w(this,"html",(e,t,r)=>{const a=s=>S(this,te,be).call(this,s,t,Ct("text/html; charset=UTF-8",r));return typeof e=="object"?zr(e,Nr.Stringify,!1,{}).then(a):a(e)});w(this,"redirect",(e,t)=>{const r=String(e);return this.header("Location",/[^\x00-\xFF]/.test(r)?encodeURI(r):r),this.newResponse(null,t??302)});w(this,"notFound",()=>(u(this,Ce)??x(this,Ce,()=>new Response),u(this,Ce).call(this,this)));x(this,Be,e),t&&(x(this,K,t.executionCtx),this.env=t.env,x(this,Ce,t.notFoundHandler),x(this,Ve,t.path),x(this,Ke,t.matchResult))}get req(){return u(this,We)??x(this,We,new Yr(u(this,Be),u(this,Ve),u(this,Ke))),u(this,We)}get event(){if(u(this,K)&&"respondWith"in u(this,K))return u(this,K);throw Error("This context has no FetchEvent")}get executionCtx(){if(u(this,K))return u(this,K);throw Error("This context has no ExecutionContext")}get res(){return u(this,D)||x(this,D,new Response(null,{headers:u(this,ue)??x(this,ue,new Headers)}))}set res(e){if(u(this,D)&&e){e=new Response(e.body,e);for(const[t,r]of u(this,D).headers.entries())if(t!=="content-type")if(t==="set-cookie"){const a=u(this,D).headers.getSetCookie();e.headers.delete("set-cookie");for(const s of a)e.headers.append("set-cookie",s)}else e.headers.set(t,r)}x(this,D,e),this.finalized=!0}get var(){return u(this,G)?Object.fromEntries(u(this,G)):{}}},Be=new WeakMap,We=new WeakMap,G=new WeakMap,Se=new WeakMap,K=new WeakMap,D=new WeakMap,Ge=new WeakMap,Pe=new WeakMap,Ce=new WeakMap,ue=new WeakMap,Ke=new WeakMap,Ve=new WeakMap,te=new WeakSet,be=function(e,t,r){const a=u(this,D)?new Headers(u(this,D).headers):u(this,ue)??new Headers;if(typeof t=="object"&&"headers"in t){const i=t.headers instanceof Headers?t.headers:new Headers(t.headers);for(const[n,l]of i)n.toLowerCase()==="set-cookie"?a.append(n,l):a.set(n,l)}if(r)for(const[i,n]of Object.entries(r))if(typeof n=="string")a.set(i,n);else{a.delete(i);for(const l of n)a.append(i,l)}const s=typeof t=="number"?t:(t==null?void 0:t.status)??u(this,Se);return new Response(e,{status:s,headers:a})},Ir),T="ALL",us="all",hs=["get","post","put","delete","options","patch"],ta="Can not add a route since the matcher is already built.",ra=class extends Error{},ps="__COMPOSED_HANDLER",gs=e=>e.text("404 Not Found",404),fr=(e,t)=>{if("getResponse"in e){const r=e.getResponse();return t.newResponse(r.body,r)}return console.error(e),t.text("Internal Server Error",500)},z,k,sa,H,le,dt,ft,Tr,aa=(Tr=class{constructor(t={}){b(this,k);w(this,"get");w(this,"post");w(this,"put");w(this,"delete");w(this,"options");w(this,"patch");w(this,"all");w(this,"on");w(this,"use");w(this,"router");w(this,"getPath");w(this,"_basePath","/");b(this,z,"/");w(this,"routes",[]);b(this,H,gs);w(this,"errorHandler",fr);w(this,"onError",t=>(this.errorHandler=t,this));w(this,"notFound",t=>(x(this,H,t),this));w(this,"fetch",(t,...r)=>S(this,k,ft).call(this,t,r[1],r[0],t.method));w(this,"request",(t,r,a,s)=>t instanceof Request?this.fetch(r?new Request(t,r):t,a,s):(t=t.toString(),this.fetch(new Request(/^https?:\/\//.test(t)?t:`http://localhost${xe("/",t)}`,r),a,s)));w(this,"fire",()=>{addEventListener("fetch",t=>{t.respondWith(S(this,k,ft).call(this,t.request,t,void 0,t.request.method))})});[...hs,us].forEach(i=>{this[i]=(n,...l)=>(typeof n=="string"?x(this,z,n):S(this,k,le).call(this,i,u(this,z),n),l.forEach(o=>{S(this,k,le).call(this,i,u(this,z),o)}),this)}),this.on=(i,n,...l)=>{for(const o of[n].flat()){x(this,z,o);for(const c of[i].flat())l.map(d=>{S(this,k,le).call(this,c.toUpperCase(),u(this,z),d)})}return this},this.use=(i,...n)=>(typeof i=="string"?x(this,z,i):(x(this,z,"*"),n.unshift(i)),n.forEach(l=>{S(this,k,le).call(this,T,u(this,z),l)}),this);const{strict:a,...s}=t;Object.assign(this,s),this.getPath=a??!0?t.getPath??Vr:os}route(t,r){const a=this.basePath(t);return r.routes.map(s=>{var n;let i;r.errorHandler===fr?i=s.handler:(i=async(l,o)=>(await cr([],r.errorHandler)(l,()=>s.handler(l,o))).res,i[ps]=s.handler),S(n=a,k,le).call(n,s.method,s.path,i)}),this}basePath(t){const r=S(this,k,sa).call(this);return r._basePath=xe(this._basePath,t),r}mount(t,r,a){let s,i;a&&(typeof a=="function"?i=a:(i=a.optionHandler,a.replaceRequest===!1?s=o=>o:s=a.replaceRequest));const n=i?o=>{const c=i(o);return Array.isArray(c)?c:[c]}:o=>{let c;try{c=o.executionCtx}catch{}return[o.env,c]};s||(s=(()=>{const o=xe(this._basePath,t),c=o==="/"?0:o.length;return d=>{const h=new URL(d.url);return h.pathname=h.pathname.slice(c)||"/",new Request(h,d)}})());const l=async(o,c)=>{const d=await r(s(o.req.raw),...n(o));if(d)return d;await c()};return S(this,k,le).call(this,T,xe(t,"*"),l),this}},z=new WeakMap,k=new WeakSet,sa=function(){const t=new aa({router:this.router,getPath:this.getPath});return t.errorHandler=this.errorHandler,x(t,H,u(this,H)),t.routes=this.routes,t},H=new WeakMap,le=function(t,r,a){t=t.toUpperCase(),r=xe(this._basePath,r);const s={basePath:this._basePath,path:r,method:t,handler:a};this.router.add(t,r,[a,s]),this.routes.push(s)},dt=function(t,r){if(t instanceof Error)return this.errorHandler(t,r);throw t},ft=function(t,r,a,s){if(s==="HEAD")return(async()=>new Response(null,await S(this,k,ft).call(this,t,r,a,"GET")))();const i=this.getPath(t,{env:a}),n=this.router.match(s,i),l=new fs(t,{path:i,matchResult:n,env:a,executionCtx:r,notFoundHandler:u(this,H)});if(n[0].length===1){let c;try{c=n[0][0][0][0](l,async()=>{l.res=await u(this,H).call(this,l)})}catch(d){return S(this,k,dt).call(this,d,l)}return c instanceof Promise?c.then(d=>d||(l.finalized?l.res:u(this,H).call(this,l))).catch(d=>S(this,k,dt).call(this,d,l)):c??u(this,H).call(this,l)}const o=cr(n[0],this.errorHandler,u(this,H));return(async()=>{try{const c=await o(l);if(!c.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return c.res}catch(c){return S(this,k,dt).call(this,c,l)}})()},Tr),vt="[^/]+",Le=".*",ze="(?:|/.*)",Ae=Symbol(),ys=new Set(".\\+*[^]$()");function ms(e,t){return e.length===1?t.length===1?e<t?-1:1:-1:t.length===1||e===Le||e===ze?1:t===Le||t===ze?-1:e===vt?1:t===vt?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var he,pe,q,kr,zt=(kr=class{constructor(){b(this,he);b(this,pe);b(this,q,Object.create(null))}insert(t,r,a,s,i){if(t.length===0){if(u(this,he)!==void 0)throw Ae;if(i)return;x(this,he,r);return}const[n,...l]=t,o=n==="*"?l.length===0?["","",Le]:["","",vt]:n==="/*"?["","",ze]:n.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let c;if(o){const d=o[1];let h=o[2]||vt;if(d&&o[2]&&(h===".*"||(h=h.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(h))))throw Ae;if(c=u(this,q)[h],!c){if(Object.keys(u(this,q)).some(f=>f!==Le&&f!==ze))throw Ae;if(i)return;c=u(this,q)[h]=new zt,d!==""&&x(c,pe,s.varIndex++)}!i&&d!==""&&a.push([d,u(c,pe)])}else if(c=u(this,q)[n],!c){if(Object.keys(u(this,q)).some(d=>d.length>1&&d!==Le&&d!==ze))throw Ae;if(i)return;c=u(this,q)[n]=new zt}c.insert(l,r,a,s,i)}buildRegExpStr(){const r=Object.keys(u(this,q)).sort(ms).map(a=>{const s=u(this,q)[a];return(typeof u(s,pe)=="number"?`(${a})@${u(s,pe)}`:ys.has(a)?`\\${a}`:a)+s.buildRegExpStr()});return typeof u(this,he)=="number"&&r.unshift(`#${u(this,he)}`),r.length===0?"":r.length===1?r[0]:"(?:"+r.join("|")+")"}},he=new WeakMap,pe=new WeakMap,q=new WeakMap,kr),xt,Xe,Or,vs=(Or=class{constructor(){b(this,xt,{varIndex:0});b(this,Xe,new zt)}insert(e,t,r){const a=[],s=[];for(let n=0;;){let l=!1;if(e=e.replace(/\{[^}]+\}/g,o=>{const c=`@\\${n}`;return s[n]=[c,o],n++,l=!0,c}),!l)break}const i=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let n=s.length-1;n>=0;n--){const[l]=s[n];for(let o=i.length-1;o>=0;o--)if(i[o].indexOf(l)!==-1){i[o]=i[o].replace(l,s[n][1]);break}}return u(this,Xe).insert(i,t,a,u(this,xt),r),a}buildRegExp(){let e=u(this,Xe).buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0;const r=[],a=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(s,i,n)=>i!==void 0?(r[++t]=Number(i),"$()"):(n!==void 0&&(a[Number(n)]=++t),"")),[new RegExp(`^${e}`),r,a]}},xt=new WeakMap,Xe=new WeakMap,Or),ia=[],ws=[/^$/,[],Object.create(null)],ut=Object.create(null);function na(e){return ut[e]??(ut[e]=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(t,r)=>r?`\\${r}`:"(?:|/.*)")}$`))}function xs(){ut=Object.create(null)}function bs(e){var c;const t=new vs,r=[];if(e.length===0)return ws;const a=e.map(d=>[!/\*|\/:/.test(d[0]),...d]).sort(([d,h],[f,g])=>d?1:f?-1:h.length-g.length),s=Object.create(null);for(let d=0,h=-1,f=a.length;d<f;d++){const[g,m,y]=a[d];g?s[m]=[y.map(([v])=>[v,Object.create(null)]),ia]:h++;let p;try{p=t.insert(m,h,g)}catch(v){throw v===Ae?new ra(m):v}g||(r[h]=y.map(([v,A])=>{const E=Object.create(null);for(A-=1;A>=0;A--){const[R,P]=p[A];E[R]=P}return[v,E]}))}const[i,n,l]=t.buildRegExp();for(let d=0,h=r.length;d<h;d++)for(let f=0,g=r[d].length;f<g;f++){const m=(c=r[d][f])==null?void 0:c[1];if(!m)continue;const y=Object.keys(m);for(let p=0,v=y.length;p<v;p++)m[y[p]]=l[m[y[p]]]}const o=[];for(const d in n)o[d]=r[n[d]];return[i,o,s]}function ve(e,t){if(e){for(const r of Object.keys(e).sort((a,s)=>s.length-a.length))if(na(r).test(t))return[...e[r]]}}var re,ae,je,oa,la,Mr,As=(Mr=class{constructor(){b(this,je);w(this,"name","RegExpRouter");b(this,re);b(this,ae);x(this,re,{[T]:Object.create(null)}),x(this,ae,{[T]:Object.create(null)})}add(e,t,r){var l;const a=u(this,re),s=u(this,ae);if(!a||!s)throw new Error(ta);a[e]||[a,s].forEach(o=>{o[e]=Object.create(null),Object.keys(o[T]).forEach(c=>{o[e][c]=[...o[T][c]]})}),t==="/*"&&(t="*");const i=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){const o=na(t);e===T?Object.keys(a).forEach(c=>{var d;(d=a[c])[t]||(d[t]=ve(a[c],t)||ve(a[T],t)||[])}):(l=a[e])[t]||(l[t]=ve(a[e],t)||ve(a[T],t)||[]),Object.keys(a).forEach(c=>{(e===T||e===c)&&Object.keys(a[c]).forEach(d=>{o.test(d)&&a[c][d].push([r,i])})}),Object.keys(s).forEach(c=>{(e===T||e===c)&&Object.keys(s[c]).forEach(d=>o.test(d)&&s[c][d].push([r,i]))});return}const n=Xr(t)||[t];for(let o=0,c=n.length;o<c;o++){const d=n[o];Object.keys(s).forEach(h=>{var f;(e===T||e===h)&&((f=s[h])[d]||(f[d]=[...ve(a[h],d)||ve(a[T],d)||[]]),s[h][d].push([r,i-c+o+1]))})}}match(e,t){xs();const r=S(this,je,oa).call(this);return this.match=(a,s)=>{const i=r[a]||r[T],n=i[2][s];if(n)return n;const l=s.match(i[0]);if(!l)return[[],ia];const o=l.indexOf("",1);return[i[1][o],l]},this.match(e,t)}},re=new WeakMap,ae=new WeakMap,je=new WeakSet,oa=function(){const e=Object.create(null);return Object.keys(u(this,ae)).concat(Object.keys(u(this,re))).forEach(t=>{e[t]||(e[t]=S(this,je,la).call(this,t))}),x(this,re,x(this,ae,void 0)),e},la=function(e){const t=[];let r=e===T;return[u(this,re),u(this,ae)].forEach(a=>{const s=a[e]?Object.keys(a[e]).map(i=>[i,a[e][i]]):[];s.length!==0?(r||(r=!0),t.push(...s)):e!==T&&t.push(...Object.keys(a[T]).map(i=>[i,a[T][i]]))}),r?bs(t):null},Mr),se,V,jr,Rs=(jr=class{constructor(e){w(this,"name","SmartRouter");b(this,se,[]);b(this,V,[]);x(this,se,e.routers)}add(e,t,r){if(!u(this,V))throw new Error(ta);u(this,V).push([e,t,r])}match(e,t){if(!u(this,V))throw new Error("Fatal error");const r=u(this,se),a=u(this,V),s=r.length;let i=0,n;for(;i<s;i++){const l=r[i];try{for(let o=0,c=a.length;o<c;o++)l.add(...a[o]);n=l.match(e,t)}catch(o){if(o instanceof ra)continue;throw o}this.match=l.match.bind(l),x(this,se,[l]),x(this,V,void 0);break}if(i===s)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,n}get activeRouter(){if(u(this,V)||u(this,se).length!==1)throw new Error("No active router has been determined yet.");return u(this,se)[0]}},se=new WeakMap,V=new WeakMap,jr),De=Object.create(null),ie,$,ge,Ie,M,X,ce,$r,ca=($r=class{constructor(e,t,r){b(this,X);b(this,ie);b(this,$);b(this,ge);b(this,Ie,0);b(this,M,De);if(x(this,$,r||Object.create(null)),x(this,ie,[]),e&&t){const a=Object.create(null);a[e]={handler:t,possibleKeys:[],score:0},x(this,ie,[a])}x(this,ge,[])}insert(e,t,r){x(this,Ie,++er(this,Ie)._);let a=this;const s=rs(t),i=[];for(let n=0,l=s.length;n<l;n++){const o=s[n],c=s[n+1],d=is(o,c),h=Array.isArray(d)?d[0]:o;if(h in u(a,$)){a=u(a,$)[h],d&&i.push(d[1]);continue}u(a,$)[h]=new ca,d&&(u(a,ge).push(d),i.push(d[1])),a=u(a,$)[h]}return u(a,ie).push({[e]:{handler:r,possibleKeys:i.filter((n,l,o)=>o.indexOf(n)===l),score:u(this,Ie)}}),a}search(e,t){var l;const r=[];x(this,M,De);let s=[this];const i=Kr(t),n=[];for(let o=0,c=i.length;o<c;o++){const d=i[o],h=o===c-1,f=[];for(let g=0,m=s.length;g<m;g++){const y=s[g],p=u(y,$)[d];p&&(x(p,M,u(y,M)),h?(u(p,$)["*"]&&r.push(...S(this,X,ce).call(this,u(p,$)["*"],e,u(y,M))),r.push(...S(this,X,ce).call(this,p,e,u(y,M)))):f.push(p));for(let v=0,A=u(y,ge).length;v<A;v++){const E=u(y,ge)[v],R=u(y,M)===De?{}:{...u(y,M)};if(E==="*"){const Y=u(y,$)["*"];Y&&(r.push(...S(this,X,ce).call(this,Y,e,u(y,M))),x(Y,M,R),f.push(Y));continue}const[P,U,oe]=E;if(!d&&!(oe instanceof RegExp))continue;const B=u(y,$)[P],Ca=i.slice(o).join("/");if(oe instanceof RegExp){const Y=oe.exec(Ca);if(Y){if(R[U]=Y[0],r.push(...S(this,X,ce).call(this,B,e,u(y,M),R)),Object.keys(u(B,$)).length){x(B,M,R);const At=((l=Y[0].match(/\//))==null?void 0:l.length)??0;(n[At]||(n[At]=[])).push(B)}continue}}(oe===!0||oe.test(d))&&(R[U]=d,h?(r.push(...S(this,X,ce).call(this,B,e,R,u(y,M))),u(B,$)["*"]&&r.push(...S(this,X,ce).call(this,u(B,$)["*"],e,R,u(y,M)))):(x(B,M,R),f.push(B)))}}s=f.concat(n.shift()??[])}return r.length>1&&r.sort((o,c)=>o.score-c.score),[r.map(({handler:o,params:c})=>[o,c])]}},ie=new WeakMap,$=new WeakMap,ge=new WeakMap,Ie=new WeakMap,M=new WeakMap,X=new WeakSet,ce=function(e,t,r,a){const s=[];for(let i=0,n=u(e,ie).length;i<n;i++){const l=u(e,ie)[i],o=l[t]||l[T],c={};if(o!==void 0&&(o.params=Object.create(null),s.push(o),r!==De||a&&a!==De))for(let d=0,h=o.possibleKeys.length;d<h;d++){const f=o.possibleKeys[d],g=c[o.score];o.params[f]=a!=null&&a[f]&&!g?a[f]:r[f]??(a==null?void 0:a[f]),c[o.score]=!0}}return s},$r),ye,Dr,Es=(Dr=class{constructor(){w(this,"name","TrieRouter");b(this,ye);x(this,ye,new ca)}add(e,t,r){const a=Xr(t);if(a){for(let s=0,i=a.length;s<i;s++)u(this,ye).insert(e,a[s],r);return}u(this,ye).insert(e,t,r)}match(e,t){return u(this,ye).search(e,t)}},ye=new WeakMap,Dr),da=class extends aa{constructor(e={}){super(e),this.router=e.router??new Rs({routers:[new As,new Es]})}},Ss=e=>{const r={...{origin:"*",allowMethods:["GET","HEAD","PUT","POST","DELETE","PATCH"],allowHeaders:[],exposeHeaders:[]},...e},a=(i=>typeof i=="string"?i==="*"?()=>i:n=>i===n?n:null:typeof i=="function"?i:n=>i.includes(n)?n:null)(r.origin),s=(i=>typeof i=="function"?i:Array.isArray(i)?()=>i:()=>[])(r.allowMethods);return async function(n,l){var d;function o(h,f){n.res.headers.set(h,f)}const c=await a(n.req.header("origin")||"",n);if(c&&o("Access-Control-Allow-Origin",c),r.origin!=="*"){const h=n.req.header("Vary");h?o("Vary",h):o("Vary","Origin")}if(r.credentials&&o("Access-Control-Allow-Credentials","true"),(d=r.exposeHeaders)!=null&&d.length&&o("Access-Control-Expose-Headers",r.exposeHeaders.join(",")),n.req.method==="OPTIONS"){r.maxAge!=null&&o("Access-Control-Max-Age",r.maxAge.toString());const h=await s(n.req.header("origin")||"",n);h.length&&o("Access-Control-Allow-Methods",h.join(","));let f=r.allowHeaders;if(!(f!=null&&f.length)){const g=n.req.header("Access-Control-Request-Headers");g&&(f=g.split(/\s*,\s*/))}return f!=null&&f.length&&(o("Access-Control-Allow-Headers",f.join(",")),n.res.headers.append("Vary","Access-Control-Request-Headers")),n.res.headers.delete("Content-Length"),n.res.headers.delete("Content-Type"),new Response(null,{headers:n.res.headers,status:204,statusText:"No Content"})}await l()}},Ps=(e,t=Is)=>{const r=/\.([a-zA-Z0-9]+?)$/,a=e.match(r);if(!a)return;let s=t[a[1]];return s&&s.startsWith("text")&&(s+="; charset=utf-8"),s},Cs={aac:"audio/aac",avi:"video/x-msvideo",avif:"image/avif",av1:"video/av1",bin:"application/octet-stream",bmp:"image/bmp",css:"text/css",csv:"text/csv",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gif:"image/gif",gz:"application/gzip",htm:"text/html",html:"text/html",ico:"image/x-icon",ics:"text/calendar",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",map:"application/json",mid:"audio/x-midi",midi:"audio/x-midi",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",pdf:"application/pdf",png:"image/png",rtf:"application/rtf",svg:"image/svg+xml",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",wasm:"application/wasm",webm:"video/webm",weba:"audio/webm",webmanifest:"application/manifest+json",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xml:"application/xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2",gltf:"model/gltf+json",glb:"model/gltf-binary"},Is=Cs,Ts=/^\s*(?:text\/[^;\s]+|application\/(?:javascript|json|xml|xml-dtd|ecmascript|dart|postscript|rtf|tar|toml|vnd\.dart|vnd\.ms-fontobject|vnd\.ms-opentype|wasm|x-httpd-php|x-javascript|x-ns-proxy-autoconfig|x-sh|x-tar|x-virtualbox-hdd|x-virtualbox-ova|x-virtualbox-ovf|x-virtualbox-vbox|x-virtualbox-vdi|x-virtualbox-vhd|x-virtualbox-vmdk|x-www-form-urlencoded)|font\/(?:otf|ttf)|image\/(?:bmp|vnd\.adobe\.photoshop|vnd\.microsoft\.icon|vnd\.ms-dds|x-icon|x-ms-bmp)|message\/rfc822|model\/gltf-binary|x-shader\/x-fragment|x-shader\/x-vertex|[^;\s]+?\+(?:json|text|xml|yaml))(?:[;\s]|$)/i,Ht={br:".br",zstd:".zst",gzip:".gz"},ks=Object.keys(Ht),ur=e=>new ReadableStream({start(r){e.on("data",a=>{r.enqueue(a)}),e.on("end",()=>{r.close()})},cancel(){e.destroy()}}),It=e=>{let t;try{t=Oa(e)}catch{}return t},et=(e={root:""})=>{const t=e.root||"",r=e.path;return t!==""&&!ka(t)&&console.error(`serveStatic: root path '${t}' is not found, are you sure it's correct?`),async(a,s)=>{var p,v,A,E;if(a.finalized)return s();let i;if(r)i=r;else try{if(i=decodeURIComponent(a.req.path),/(?:^|[\/\\])\.\.(?:$|[\/\\])/.test(i))throw new Error}catch{return await((p=e.onNotFound)==null?void 0:p.call(e,a.req.path,a)),s()}let n=rr(t,!r&&e.rewriteRequestPath?e.rewriteRequestPath(i,a):i),l=It(n);if(l&&l.isDirectory()){const R=e.index??"index.html";n=rr(n,R),l=It(n)}if(!l)return await((v=e.onNotFound)==null?void 0:v.call(e,n,a)),s();await((A=e.onFound)==null?void 0:A.call(e,n,a));const o=Ps(n);if(a.header("Content-Type",o||"application/octet-stream"),e.precompressed&&(!o||Ts.test(o))){const R=new Set((E=a.req.header("Accept-Encoding"))==null?void 0:E.split(",").map(P=>P.trim()));for(const P of ks){if(!R.has(P))continue;const U=It(n+Ht[P]);if(U){a.header("Content-Encoding",P),a.header("Vary","Accept-Encoding",{append:!0}),l=U,n=n+Ht[P];break}}}const c=l.size;if(a.req.method=="HEAD"||a.req.method=="OPTIONS")return a.header("Content-Length",c.toString()),a.status(200),a.body(null);const d=a.req.header("range")||"";if(!d)return a.header("Content-Length",c.toString()),a.body(ur(tr(n)),200);a.header("Accept-Ranges","bytes"),a.header("Date",l.birthtime.toUTCString());const h=d.replace(/bytes=/,"").split("-",2),f=parseInt(h[0],10)||0;let g=parseInt(h[1],10)||c-1;c<g-f+1&&(g=c-1);const m=g-f+1,y=tr(n,{start:f,end:g});return a.header("Content-Length",m.toString()),a.header("Content-Range",`bytes ${f}-${g}/${l.size}`),a.body(ur(y),206)}},qe="_hp",Os={Change:"Input",DoubleClick:"DblClick"},Ms={svg:"2000/svg",math:"1998/Math/MathML"},Fe=[],qt=new WeakMap,Oe=void 0,js=()=>Oe,W=e=>"t"in e,Tt={onClick:["click",!1]},hr=e=>{if(!e.startsWith("on"))return;if(Tt[e])return Tt[e];const t=e.match(/^on([A-Z][a-zA-Z]+?(?:PointerCapture)?)(Capture)?$/);if(t){const[,r,a]=t;return Tt[e]=[(Os[r]||r).toLowerCase(),!!a]}},pr=(e,t)=>Oe&&e instanceof SVGElement&&/[A-Z]/.test(t)&&(t in e.style||t.match(/^(?:o|pai|str|u|ve)/))?t.replace(/([A-Z])/g,"-$1").toLowerCase():t,$s=(e,t,r)=>{var a;t||(t={});for(let s in t){const i=t[s];if(s!=="children"&&(!r||r[s]!==i)){s=mt(s);const n=hr(s);if(n){if((r==null?void 0:r[s])!==i&&(r&&e.removeEventListener(n[0],r[s],n[1]),i!=null)){if(typeof i!="function")throw new Error(`Event handler for "${s}" is not a function`);e.addEventListener(n[0],i,n[1])}}else if(s==="dangerouslySetInnerHTML"&&i)e.innerHTML=i.__html;else if(s==="ref"){let l;typeof i=="function"?l=i(e)||(()=>i(null)):i&&"current"in i&&(i.current=e,l=()=>i.current=null),qt.set(e,l)}else if(s==="style"){const l=e.style;typeof i=="string"?l.cssText=i:(l.cssText="",i!=null&&Wr(i,l.setProperty.bind(l)))}else{if(s==="value"){const o=e.nodeName;if(o==="INPUT"||o==="TEXTAREA"||o==="SELECT"){if(e.value=i==null||i===!1?null:i,o==="TEXTAREA"){e.textContent=i;continue}else if(o==="SELECT"){e.selectedIndex===-1&&(e.selectedIndex=0);continue}}}else(s==="checked"&&e.nodeName==="INPUT"||s==="selected"&&e.nodeName==="OPTION")&&(e[s]=i);const l=pr(e,s);i==null||i===!1?e.removeAttribute(l):i===!0?e.setAttribute(l,""):typeof i=="string"||typeof i=="number"?e.setAttribute(l,i):e.setAttribute(l,i.toString())}}}if(r)for(let s in r){const i=r[s];if(s!=="children"&&!(s in t)){s=mt(s);const n=hr(s);n?e.removeEventListener(n[0],i,n[1]):s==="ref"?(a=qt.get(e))==null||a():e.removeAttribute(pr(e,s))}}},Ds=(e,t)=>{t[I][0]=0,Fe.push([e,t]);const r=t.tag[Bt]||t.tag,a=r.defaultProps?{...r.defaultProps,...t.props}:t.props;try{return[r.call(null,a)]}finally{Fe.pop()}},fa=(e,t,r,a,s)=>{var i,n;(i=e.vR)!=null&&i.length&&(a.push(...e.vR),delete e.vR),typeof e.tag=="function"&&((n=e[I][1][ga])==null||n.forEach(l=>s.push(l))),e.vC.forEach(l=>{var o;if(W(l))r.push(l);else if(typeof l.tag=="function"||l.tag===""){l.c=t;const c=r.length;if(fa(l,t,r,a,s),l.s){for(let d=c;d<r.length;d++)r[d].s=!0;l.s=!1}}else r.push(l),(o=l.vR)!=null&&o.length&&(a.push(...l.vR),delete l.vR)})},Ns=e=>{for(;;e=e.tag===qe||!e.vC||!e.pP?e.nN:e.vC[0]){if(!e)return null;if(e.tag!==qe&&e.e)return e.e}},ua=e=>{var t,r,a,s,i,n;W(e)||((r=(t=e[I])==null?void 0:t[1][ga])==null||r.forEach(l=>{var o;return(o=l[2])==null?void 0:o.call(l)}),(a=qt.get(e.e))==null||a(),e.p===2&&((s=e.vC)==null||s.forEach(l=>l.p=2)),(i=e.vC)==null||i.forEach(ua)),e.p||((n=e.e)==null||n.remove(),delete e.e),typeof e.tag=="function"&&(_e.delete(e),ht.delete(e),delete e[I][3],e.a=!0)},ha=(e,t,r)=>{e.c=t,pa(e,t,r)},gr=(e,t)=>{if(t){for(let r=0,a=e.length;r<a;r++)if(e[r]===t)return r}},yr=Symbol(),pa=(e,t,r)=>{var c;const a=[],s=[],i=[];fa(e,t,a,s,i),s.forEach(ua);const n=r?void 0:t.childNodes;let l,o=null;if(r)l=-1;else if(!n.length)l=0;else{const d=gr(n,Ns(e.nN));d!==void 0?(o=n[d],l=d):l=gr(n,(c=a.find(h=>h.tag!==qe&&h.e))==null?void 0:c.e)??-1,l===-1&&(r=!0)}for(let d=0,h=a.length;d<h;d++,l++){const f=a[d];let g;if(f.s&&f.e)g=f.e,f.s=!1;else{const m=r||!f.e;W(f)?(f.e&&f.d&&(f.e.textContent=f.t),f.d=!1,g=f.e||(f.e=document.createTextNode(f.t))):(g=f.e||(f.e=f.n?document.createElementNS(f.n,f.tag):document.createElement(f.tag)),$s(g,f.props,f.pP),pa(f,g,m))}f.tag===qe?l--:r?g.parentNode||t.appendChild(g):n[l]!==g&&n[l-1]!==g&&(n[l+1]===g?t.appendChild(n[l]):t.insertBefore(g,o||n[l]||null))}if(e.pP&&delete e.pP,i.length){const d=[],h=[];i.forEach(([,f,,g,m])=>{f&&d.push(f),g&&h.push(g),m==null||m()}),d.forEach(f=>f()),h.length&&requestAnimationFrame(()=>{h.forEach(f=>f())})}},_s=(e,t)=>!!(e&&e.length===t.length&&e.every((r,a)=>r[1]===t[a][1])),ht=new WeakMap,Ft=(e,t,r)=>{var i,n,l,o,c,d;const a=!r&&t.pC;r&&(t.pC||(t.pC=t.vC));let s;try{r||(r=typeof t.tag=="function"?Ds(e,t):Je(t.props.children)),((i=r[0])==null?void 0:i.tag)===""&&r[0][Nt]&&(s=r[0][Nt],e[5].push([e,s,t]));const h=a?[...t.pC]:t.vC?[...t.vC]:void 0,f=[];let g;for(let m=0;m<r.length;m++){Array.isArray(r[m])&&r.splice(m,1,...r[m].flat());let y=Ls(r[m]);if(y){typeof y.tag=="function"&&!y.tag[Hr]&&(ke.length>0&&(y[I][2]=ke.map(v=>[v,v.values.at(-1)])),(n=e[5])!=null&&n.length&&(y[I][3]=e[5].at(-1)));let p;if(h&&h.length){const v=h.findIndex(W(y)?A=>W(A):y.key!==void 0?A=>A.key===y.key&&A.tag===y.tag:A=>A.tag===y.tag);v!==-1&&(p=h[v],h.splice(v,1))}if(p)if(W(y))p.t!==y.t&&(p.t=y.t,p.d=!0),y=p;else{const v=p.pP=p.props;if(p.props=y.props,p.f||(p.f=y.f||t.f),typeof y.tag=="function"){const A=p[I][2];p[I][2]=y[I][2]||[],p[I][3]=y[I][3],!p.f&&((p.o||p)===y.o||(o=(l=p.tag)[Na])!=null&&o.call(l,v,p.props))&&_s(A,p[I][2])&&(p.s=!0)}y=p}else if(!W(y)&&Oe){const v=$e(Oe);v&&(y.n=v)}if(!W(y)&&!y.s&&(Ft(e,y),delete y.f),f.push(y),g&&!g.s&&!y.s)for(let v=g;v&&!W(v);v=(c=v.vC)==null?void 0:c.at(-1))v.nN=y;g=y}}t.vR=a?[...t.vC,...h||[]]:h||[],t.vC=f,a&&delete t.pC}catch(h){if(t.f=!0,h===yr){if(s)return;throw h}const[f,g,m]=((d=t[I])==null?void 0:d[3])||[];if(g){const y=()=>pt([0,!1,e[2]],m),p=ht.get(m)||[];p.push(y),ht.set(m,p);const v=g(h,()=>{const A=ht.get(m);if(A){const E=A.indexOf(y);if(E!==-1)return A.splice(E,1),y()}});if(v){if(e[0]===1)e[1]=!0;else if(Ft(e,m,[v]),(g.length===1||e!==f)&&m.c){ha(m,m.c,!1);return}throw yr}}throw h}finally{s&&e[5].pop()}},Ls=e=>{if(!(e==null||typeof e=="boolean")){if(typeof e=="string"||typeof e=="number")return{t:e.toString(),d:!0};if("vR"in e&&(e={tag:e.tag,props:e.props,key:e.key,f:e.f,type:e.tag,ref:e.props.ref,o:e.o||e}),typeof e.tag=="function")e[I]=[0,[]];else{const t=Ms[e.tag];t&&(Oe||(Oe=Fr("")),e.props.children=[{tag:Oe,props:{value:e.n=`http://www.w3.org/${t}`,children:e.props.children}}])}return e}},mr=(e,t)=>{var r,a;(r=t[I][2])==null||r.forEach(([s,i])=>{s.values.push(i)});try{Ft(e,t,void 0)}catch{return}if(t.a){delete t.a;return}(a=t[I][2])==null||a.forEach(([s])=>{s.values.pop()}),(e[0]!==1||!e[1])&&ha(t,t.c,!1)},_e=new WeakMap,vr=[],pt=async(e,t)=>{e[5]||(e[5]=[]);const r=_e.get(t);r&&r[0](void 0);let a;const s=new Promise(i=>a=i);if(_e.set(t,[a,()=>{e[2]?e[2](e,t,i=>{mr(i,t)}).then(()=>a(t)):(mr(e,t),a(t))}]),vr.length)vr.at(-1).add(t);else{await Promise.resolve();const i=_e.get(t);i&&(_e.delete(t),i[1]())}return s},zs=(e,t,r)=>({tag:qe,props:{children:e},key:r,e:t,p:1}),kt=0,ga=1,Ot=2,Mt=3,jt=new WeakMap,ya=(e,t)=>!e||!t||e.length!==t.length||t.some((r,a)=>r!==e[a]),Hs=void 0,wr=[],qs=e=>{var n;const t=()=>typeof e=="function"?e():e,r=Fe.at(-1);if(!r)return[t(),()=>{}];const[,a]=r,s=(n=a[I][1])[kt]||(n[kt]=[]),i=a[I][0]++;return s[i]||(s[i]=[t(),l=>{const o=Hs,c=s[i];if(typeof l=="function"&&(l=l(c[0])),!Object.is(l,c[0]))if(c[0]=l,wr.length){const[d,h]=wr.at(-1);Promise.all([d===3?a:pt([d,!1,o],a),h]).then(([f])=>{if(!f||!(d===2||d===3))return;const g=f.vC;requestAnimationFrame(()=>{setTimeout(()=>{g===f.vC&&pt([d===3?1:0,!1,o],f)})})})}else pt([0,!1,o],a)}])},Xt=(e,t)=>{var l;const r=Fe.at(-1);if(!r)return e;const[,a]=r,s=(l=a[I][1])[Ot]||(l[Ot]=[]),i=a[I][0]++,n=s[i];return ya(n==null?void 0:n[1],t)?s[i]=[e,t]:e=s[i][0],e},Fs=e=>{const t=jt.get(e);if(t){if(t.length===2)throw t[1];return t[0]}throw e.then(r=>jt.set(e,[r]),r=>jt.set(e,[void 0,r])),e},Us=(e,t)=>{var l;const r=Fe.at(-1);if(!r)return e();const[,a]=r,s=(l=a[I][1])[Mt]||(l[Mt]=[]),i=a[I][0]++,n=s[i];return ya(n==null?void 0:n[1],t)&&(s[i]=[e(),t]),s[i][0]},Bs=Fr({pending:!1,data:null,method:null,action:null}),xr=new Set,Ws=e=>{xr.add(e),e.finally(()=>xr.delete(e))},Zt=(e,t)=>Us(()=>r=>{let a;e&&(typeof e=="function"?a=e(r)||(()=>{e(null)}):e&&"current"in e&&(e.current=r,a=()=>{e.current=null}));const s=t(r);return()=>{s==null||s(),a==null||a()}},[e]),we=Object.create(null),st=Object.create(null),tt=(e,t,r,a,s)=>{if(t!=null&&t.itemProp)return{tag:e,props:t,type:e,ref:t.ref};const i=document.head;let{onLoad:n,onError:l,precedence:o,blocking:c,...d}=t,h=null,f=!1;const g=ot[e];let m;if(g.length>0){const A=i.querySelectorAll(e);e:for(const E of A)for(const R of ot[e])if(E.getAttribute(R)===t[R]){h=E;break e}if(!h){const E=g.reduce((R,P)=>t[P]===void 0?R:`${R}-${P}-${t[P]}`,e);f=!st[E],h=st[E]||(st[E]=(()=>{const R=document.createElement(e);for(const P of g)t[P]!==void 0&&R.setAttribute(P,t[P]),t.rel&&R.setAttribute("rel",t.rel);return R})())}}else m=i.querySelectorAll(e);o=a?o??"":void 0,a&&(d[lt]=o);const y=Xt(A=>{if(g.length>0){let E=!1;for(const R of i.querySelectorAll(e)){if(E&&R.getAttribute(lt)!==o){i.insertBefore(A,R);return}R.getAttribute(lt)===o&&(E=!0)}i.appendChild(A)}else if(m){let E=!1;for(const R of m)if(R===A){E=!0;break}E||i.insertBefore(A,i.contains(m[0])?m[0]:i.querySelector(e)),m=void 0}},[o]),p=Zt(t.ref,A=>{var P;const E=g[0];if(r===2&&(A.innerHTML=""),(f||m)&&y(A),!l&&!n)return;let R=we[P=A.getAttribute(E)]||(we[P]=new Promise((U,oe)=>{A.addEventListener("load",U),A.addEventListener("error",oe)}));n&&(R=R.then(n)),l&&(R=R.catch(l)),R.catch(()=>{})});if(s&&c==="render"){const A=ot[e][0];if(t[A]){const E=t[A],R=we[E]||(we[E]=new Promise((P,U)=>{y(h),h.addEventListener("load",P),h.addEventListener("error",U)}));Fs(R)}}const v={tag:e,type:e,props:{...d,ref:p},ref:p};return v.p=r,h&&(v.e=h),zs(v,i)},Gs=e=>{const t=js(),r=t&&$e(t);return r!=null&&r.endsWith("svg")?{tag:"title",props:e,type:"title",ref:e.ref}:tt("title",e,void 0,!1,!1)},Ks=e=>!e||["src","async"].some(t=>!e[t])?{tag:"script",props:e,type:"script",ref:e.ref}:tt("script",e,1,!1,!0),Vs=e=>!e||!["href","precedence"].every(t=>t in e)?{tag:"style",props:e,type:"style",ref:e.ref}:(e["data-href"]=e.href,delete e.href,tt("style",e,2,!0,!0)),Xs=e=>!e||["onLoad","onError"].some(t=>t in e)||e.rel==="stylesheet"&&(!("precedence"in e)||"disabled"in e)?{tag:"link",props:e,type:"link",ref:e.ref}:tt("link",e,1,"precedence"in e,!0),Zs=e=>tt("meta",e,void 0,!1,!1),ma=Symbol(),Js=e=>{const{action:t,...r}=e;typeof t!="function"&&(r.action=t);const[a,s]=qs([null,!1]),i=Xt(async c=>{const d=c.isTrusted?t:c.detail[ma];if(typeof d!="function")return;c.preventDefault();const h=new FormData(c.target);s([h,!0]);const f=d(h);f instanceof Promise&&(Ws(f),await f),s([null,!0])},[]),n=Zt(e.ref,c=>(c.addEventListener("submit",i),()=>{c.removeEventListener("submit",i)})),[l,o]=a;return a[1]=!1,{tag:Bs,props:{value:{pending:l!==null,data:l,method:l?"post":null,action:l?t:null},children:{tag:"form",props:{...r,ref:n},type:"form",ref:n}},f:o}},va=(e,{formAction:t,...r})=>{if(typeof t=="function"){const a=Xt(s=>{s.preventDefault(),s.currentTarget.form.dispatchEvent(new CustomEvent("submit",{detail:{[ma]:t}}))},[]);r.ref=Zt(r.ref,s=>(s.addEventListener("click",a),()=>{s.removeEventListener("click",a)}))}return{tag:e,props:r,type:e,ref:r.ref}},Ys=e=>va("input",e),Qs=e=>va("button",e);Object.assign(_t,{title:Gs,script:Ks,style:Vs,link:Xs,meta:Zs,form:Js,input:Ys,button:Qs});Wt(null);new TextEncoder;var ei=Wt(null),ti=(e,t,r,a)=>(s,i)=>{const n="<!DOCTYPE html>",l=r?or(c=>r(c,e),{Layout:t,...i},s):s,o=Da`${L(n)}${or(ei.Provider,{value:e},l)}`;return e.html(o)},ri=(e,t)=>function(a,s){const i=a.getLayout()??Xa;return e&&a.setLayout(n=>e({...n,Layout:i},a)),a.setRenderer(ti(a,i,e)),s()};const ai=ri(({children:e})=>O("html",{lang:"ko",children:[O("head",{children:[O("meta",{charset:"UTF-8"}),O("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),O("title",{children:"PwC 온톨로지 자동 구축 서비스"}),O("script",{src:"https://cdn.tailwindcss.com"}),O("link",{href:"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css",rel:"stylesheet"}),O("script",{crossorigin:!0,src:"https://unpkg.com/react@18/umd/react.development.js"}),O("script",{crossorigin:!0,src:"https://unpkg.com/react-dom@18/umd/react-dom.development.js"}),O("script",{src:"https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"}),O("script",{src:"https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"}),O("script",{src:"https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"}),O("link",{href:"/static/styles.css",rel:"stylesheet"}),O("style",{children:`
          body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
          }
          
          .graph-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
          }
          
          .control-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            min-width: 300px;
          }
          
          .insight-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            min-width: 280px;
            max-height: 60vh;
            overflow-y: auto;
          }
          
          .status-bar {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
          }
          
          .pulse {
            animation: pulse 2s infinite;
          }
          
          @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
          }
          
          .glow {
            animation: glow 2s ease-in-out infinite alternate;
          }
          
          @keyframes glow {
            from { box-shadow: 0 0 5px #e74c3c; }
            to { box-shadow: 0 0 20px #e74c3c, 0 0 30px #e74c3c; }
          }
          
          .slide-in {
            animation: slideIn 0.5s ease-out;
          }
          
          @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
          }
        `})]}),O("body",{children:[e,O("script",{src:"/static/app.js"})]})]})),si=[{id:"pwc-global",label:"PwC Global",type:"organization",category:"global"},{id:"pwc-korea",label:"PwC Korea",type:"organization",category:"country"},{id:"advisory",label:"Advisory",type:"division",category:"business-unit",aliases:["어드바이저리","자문"]},{id:"assurance",label:"Assurance",type:"division",category:"business-unit",aliases:["어슈어런스","보증"]},{id:"tax",label:"Tax & Legal",type:"division",category:"business-unit",aliases:["세무","택스"]},{id:"consulting",label:"Consulting",type:"division",category:"business-unit",aliases:["컨설팅"]},{id:"deals",label:"Deals",type:"practice",category:"service-line",aliases:["딜스","M&A","인수합병"]},{id:"risk",label:"Risk Assurance",type:"practice",category:"service-line",aliases:["리스크","위험관리"]},{id:"forensics",label:"Forensics",type:"practice",category:"service-line",aliases:["포렌식","수사"]},{id:"strategy",label:"Strategy&",type:"practice",category:"service-line",aliases:["전략","스트래티지"]},{id:"technology",label:"Technology Consulting",type:"practice",category:"service-line",aliases:["기술컨설팅","IT컨설팅"]},{id:"operations",label:"Operations",type:"practice",category:"service-line",aliases:["운영","오퍼레이션"]},{id:"people-org",label:"People & Organisation",type:"practice",category:"service-line",aliases:["인사조직","HR"]}],ii=[{id:"financial-services",label:"Financial Services",type:"industry",category:"sector",aliases:["금융","FS","은행","보험","증권"]},{id:"manufacturing",label:"Manufacturing",type:"industry",category:"sector",aliases:["제조업","제조","생산"]},{id:"retail-consumer",label:"Retail & Consumer",type:"industry",category:"sector",aliases:["소매","유통","소비재","CPG"]},{id:"healthcare",label:"Healthcare",type:"industry",category:"sector",aliases:["헬스케어","의료","제약","바이오"]},{id:"energy",label:"Energy, Utilities & Resources",type:"industry",category:"sector",aliases:["에너지","유틸리티","자원","전력","가스"]},{id:"tmt",label:"Technology, Media & Telecommunications",type:"industry",category:"sector",aliases:["TMT","기술","미디어","통신","IT","테크"]},{id:"automotive",label:"Automotive",type:"industry",category:"sector",aliases:["자동차","모빌리티","완성차","부품"]},{id:"aerospace",label:"Aerospace & Defence",type:"industry",category:"sector",aliases:["항공우주","방산","국방"]},{id:"samsung",label:"Samsung",type:"client",category:"enterprise",aliases:["삼성","삼성그룹"]},{id:"lg",label:"LG",type:"client",category:"enterprise",aliases:["엘지","LG그룹"]},{id:"sk",label:"SK",type:"client",category:"enterprise",aliases:["SK그룹"]},{id:"hyundai",label:"Hyundai Motor",type:"client",category:"enterprise",aliases:["현대자동차","현대차"]}],ni=[{id:"digital-transformation",label:"Digital Transformation",type:"capability",category:"digital",aliases:["디지털전환","DX","디지털혁신"]},{id:"ai-analytics",label:"AI & Analytics",type:"capability",category:"digital",aliases:["AI","인공지능","애널리틱스","데이터분석","ML","머신러닝"]},{id:"cloud",label:"Cloud",type:"capability",category:"digital",aliases:["클라우드","클라우드전환"]},{id:"cybersecurity",label:"Cybersecurity",type:"capability",category:"digital",aliases:["사이버보안","보안","정보보호"]},{id:"corporate-strategy",label:"Corporate Strategy",type:"capability",category:"strategy",aliases:["기업전략","전사전략"]},{id:"digital-strategy",label:"Digital Strategy",type:"capability",category:"strategy",aliases:["디지털전략"]},{id:"innovation",label:"Innovation",type:"capability",category:"strategy",aliases:["혁신","이노베이션"]},{id:"supply-chain",label:"Supply Chain",type:"capability",category:"operations",aliases:["공급망","SCM","S&OP"]},{id:"process-optimization",label:"Process Optimization",type:"capability",category:"operations",aliases:["프로세스최적화","업무개선","BPR"]},{id:"cost-reduction",label:"Cost Reduction",type:"capability",category:"operations",aliases:["비용절감","원가절감"]},{id:"sap",label:"SAP",type:"technology",category:"platform",aliases:["SAP","ERP"]},{id:"salesforce",label:"Salesforce",type:"technology",category:"platform",aliases:["세일즈포스","CRM"]},{id:"palantir",label:"Palantir",type:"technology",category:"platform",aliases:["팔란티어","데이터플랫폼"]},{id:"alteryx",label:"Alteryx",type:"technology",category:"platform",aliases:["알테릭스","데이터분석툴"]}],oi=[{id:"proposal",label:"Proposal",type:"deliverable",category:"document",aliases:["제안서","프로포절","RFP응답"]},{id:"final-report",label:"Final Report",type:"deliverable",category:"document",aliases:["최종보고서","결과보고서"]},{id:"executive-summary",label:"Executive Summary",type:"deliverable",category:"document",aliases:["경영진요약","임원요약","ExSum"]},{id:"business-case",label:"Business Case",type:"deliverable",category:"document",aliases:["사업타당성","비즈니스케이스"]},{id:"operating-model",label:"Operating Model",type:"deliverable",category:"framework",aliases:["운영모델","조직모델"]},{id:"roadmap",label:"Roadmap",type:"deliverable",category:"framework",aliases:["로드맵","실행계획"]},{id:"kpi-dashboard",label:"KPI Dashboard",type:"deliverable",category:"framework",aliases:["KPI","성과지표","대시보드"]},{id:"data-platform",label:"Data Platform",type:"deliverable",category:"system",aliases:["데이터플랫폼","데이터레이크"]},{id:"analytics-model",label:"Analytics Model",type:"deliverable",category:"system",aliases:["분석모델","예측모델"]}],li=[{id:"roi",label:"ROI",type:"kpi",category:"financial",aliases:["투자수익률","Return on Investment"]},{id:"cost-saving",label:"Cost Saving",type:"kpi",category:"financial",aliases:["비용절감","원가절감액"]},{id:"revenue-growth",label:"Revenue Growth",type:"kpi",category:"financial",aliases:["매출성장률","수익증가"]},{id:"efficiency",label:"Efficiency",type:"kpi",category:"operational",aliases:["효율성","생산성"]},{id:"time-to-market",label:"Time to Market",type:"kpi",category:"operational",aliases:["출시시간","TTM"]},{id:"customer-satisfaction",label:"Customer Satisfaction",type:"kpi",category:"operational",aliases:["고객만족도","CSAT","NPS"]},{id:"digital-adoption",label:"Digital Adoption",type:"kpi",category:"digital",aliases:["디지털도입률","디지털활용률"]},{id:"automation-rate",label:"Automation Rate",type:"kpi",category:"digital",aliases:["자동화율","RPA효과"]}],ci=[{source:"pwc-global",target:"pwc-korea",type:"contains",weight:1},{source:"pwc-korea",target:"advisory",type:"contains",weight:1},{source:"pwc-korea",target:"assurance",type:"contains",weight:1},{source:"pwc-korea",target:"tax",type:"contains",weight:1},{source:"pwc-korea",target:"consulting",type:"contains",weight:1},{source:"advisory",target:"deals",type:"contains",weight:1},{source:"advisory",target:"risk",type:"contains",weight:1},{source:"advisory",target:"forensics",type:"contains",weight:1},{source:"consulting",target:"strategy",type:"contains",weight:1},{source:"consulting",target:"technology",type:"contains",weight:1},{source:"consulting",target:"operations",type:"contains",weight:1},{source:"consulting",target:"people-org",type:"contains",weight:1},{source:"technology",target:"digital-transformation",type:"provides",weight:.9},{source:"technology",target:"ai-analytics",type:"provides",weight:.9},{source:"technology",target:"cloud",type:"provides",weight:.8},{source:"technology",target:"cybersecurity",type:"provides",weight:.7},{source:"strategy",target:"corporate-strategy",type:"provides",weight:.9},{source:"strategy",target:"digital-strategy",type:"provides",weight:.8},{source:"strategy",target:"innovation",type:"provides",weight:.7},{source:"operations",target:"supply-chain",type:"provides",weight:.9},{source:"operations",target:"process-optimization",type:"provides",weight:.8},{source:"operations",target:"cost-reduction",type:"provides",weight:.8},{source:"ai-analytics",target:"palantir",type:"uses",weight:.8},{source:"ai-analytics",target:"alteryx",type:"uses",weight:.7},{source:"digital-transformation",target:"sap",type:"uses",weight:.7},{source:"digital-transformation",target:"salesforce",type:"uses",weight:.6},{source:"tmt",target:"samsung",type:"includes",weight:.9},{source:"tmt",target:"lg",type:"includes",weight:.8},{source:"automotive",target:"hyundai",type:"includes",weight:.9},{source:"energy",target:"sk",type:"includes",weight:.8},{source:"corporate-strategy",target:"business-case",type:"generates",weight:.8},{source:"digital-strategy",target:"roadmap",type:"generates",weight:.8},{source:"ai-analytics",target:"data-platform",type:"generates",weight:.8},{source:"ai-analytics",target:"analytics-model",type:"generates",weight:.9},{source:"process-optimization",target:"operating-model",type:"generates",weight:.7},{source:"cost-reduction",target:"cost-saving",type:"measures",weight:.9},{source:"digital-transformation",target:"digital-adoption",type:"measures",weight:.8},{source:"process-optimization",target:"efficiency",type:"measures",weight:.8},{source:"ai-analytics",target:"automation-rate",type:"measures",weight:.7},{source:"samsung",target:"digital-transformation",type:"requests",weight:.8},{source:"samsung",target:"supply-chain",type:"requests",weight:.7},{source:"hyundai",target:"ai-analytics",type:"requests",weight:.8},{source:"lg",target:"cloud",type:"requests",weight:.7}],br={entities:[...si,...ii,...ni,...oi,...li],relationships:ci};function di(){const e=br.entities.map((r,a)=>({id:r.id,label:r.label,type:r.type,category:r.category,x:a%10*80-400,y:Math.floor(a/10)*80-200,z:a%3*50,color:fi(r.type),aliases:r.aliases||[],metadata:r.metadata||{}})),t=br.relationships.map(r=>({source:r.source,target:r.target,type:r.type,strength:r.weight}));return{nodes:e,links:t}}function fi(e){return{organization:"#e74c3c",division:"#c0392b",practice:"#e67e22",industry:"#3498db",client:"#2980b9",capability:"#2ecc71",technology:"#9b59b6",deliverable:"#f39c12",kpi:"#1abc9c",document:"#95a5a6"}[e]||"#34495e"}const j=new da;j.use("/api/*",Ss());j.use("/static/*",async(e,t)=>{console.log(`[Static] Requested: ${e.req.path}`);try{return await et({root:"./public",onNotFound:r=>{console.log(`[Static] File not found: ${r}`)}})(e,t)}catch(r){return console.error(`[Static] Error serving ${e.req.path}:`,r),e.text("Static file error",500)}});j.get("/favicon.ico",async e=>e.body(new Uint8Array([0]),200,{"Content-Type":"image/x-icon"}));j.use(ai);j.get("/api/health",e=>e.json({status:"healthy",timestamp:new Date().toISOString()}));let C=[],N=[];const wa=()=>{const{nodes:e,links:t}=di();return{seedNodes:e,seedLinks:t}};j.get("/api/ontology/nodes",e=>e.json(C));j.get("/api/ontology/links",e=>e.json(N));j.post("/api/ontology/reset",async e=>{const t=await e.req.json().catch(()=>({})),{loadSeed:r=!1}=t;if(r){const{seedNodes:a,seedLinks:s}=wa();return C=[...a],N=[...s],e.json({success:!0,message:"PwC 시드 온톨로지로 리셋되었습니다.",nodeCount:C.length,linkCount:N.length})}else return C=[],N=[],e.json({success:!0,message:"빈 그래프로 리셋되었습니다.",nodeCount:0,linkCount:0})});j.get("/api/ontology/status",e=>{const{seedNodes:t,seedLinks:r}=wa();return e.json({totalNodes:C.length,totalLinks:N.length,seedNodes:t.length,seedLinks:r.length,addedNodes:Math.max(0,C.length-(C.length>0?t.length:0)),addedLinks:Math.max(0,N.length-(N.length>0?r.length:0)),categories:{organization:C.filter(a=>a.type==="organization").length,industry:C.filter(a=>a.type==="industry").length,capability:C.filter(a=>a.type==="capability").length,technology:C.filter(a=>a.type==="technology").length,deliverable:C.filter(a=>a.type==="deliverable").length,kpi:C.filter(a=>a.type==="kpi").length,pdf_page:C.filter(a=>a.type==="pdf_page").length,pdf_page_image:C.filter(a=>a.type==="pdf_page_image").length}})});j.post("/api/search",async e=>{const{query:t}=await e.req.json(),r={nodes:[{id:"digital",score:.95},{id:"ai",score:.8},{id:"analytics",score:.7}],path:["digital","analytics","ai"],insights:["Found 3 related capabilities","Strong connection between Digital Services and AI","Recommended next step: Explore AI use cases"]};return e.json(r)});j.post("/api/documents/upload",async e=>{var t;try{const r=await e.req.json(),{fileName:a,fileContent:s,fileSize:i,processingMode:n="unified"}=r,l=a.toLowerCase().endsWith(".pdf");if(l&&n==="unified"){const o=Date.now(),c=await Rr(a,s),d=await Pr(c),h=await Sr(a,i),f=await Er(a,i),g=[],m=[];d.autoApproved.forEach(p=>{if(p.type==="entity"){const v={id:p.data.id,label:p.data.text,type:p.data.type,category:p.data.category,x:Math.random()*400-200,y:Math.random()*400-200,z:Math.random()*200-100,color:Ar(p.data.type),isNew:!0,confidence:p.data.confidence,source:c.id,processingType:"ontology"};C.push(v),g.push(v)}else if(p.type==="relationship"){const v={source:p.data.source,target:p.data.target,type:p.data.type,strength:p.data.confidence,evidence:p.data.evidence,source_doc:c.id,processingType:"ontology"};N.push(v),m.push(v)}}),h.pageNodes.forEach(p=>{const v={...p,processingType:"pages",isNew:!0};C.push(v),g.push(v)}),f.pageImages.forEach(p=>{const v={...p,processingType:"images",isNew:!0};C.push(v),g.push(v)}),h.pageRelationships.forEach(p=>{const v={source:p.source,target:p.target,type:p.type,strength:p.strength,evidence:p.evidence,processingType:"pages"};N.push(v),m.push(v)}),f.pageRelationships.forEach(p=>{const v={source:p.source,target:p.target,type:p.type,strength:p.strength,evidence:p.evidence,processingType:"images"};N.push(v),m.push(v)});const y=Date.now()-o;return e.json({success:!0,processingMode:"unified",processedDocument:{id:c.id,filename:a,title:h.title||c.title,totalPages:h.totalPages,mainTopics:[...new Set([...h.mainTopics,...f.mainTopics])],summary:`통합 처리: ${h.documentSummary}`,aiKeywordCount:f.aiKeywordCount||0,consultingInsightCount:f.consultingInsightCount||0},ontologyAnalysis:{entities:d.autoApproved.filter(p=>p.type==="entity").length,relationships:d.autoApproved.filter(p=>p.type==="relationship").length,needsReview:d.needsReview.length,processingTime:((t=c.metadata)==null?void 0:t.processingTime)||0},pdfAnalysis:{pages:h.totalPages,pageNodes:h.pageNodes.length,pageRelationships:h.pageRelationships.length,mainTopics:h.mainTopics,processingTime:h.metadata.processingTime},pdfImageAnalysis:{pages:f.totalPages,pageImages:f.pageImages.length,pageRelationships:f.pageRelationships.length,mainTopics:f.mainTopics,processingTime:f.metadata.processingTime},needsReview:{count:d.needsReview.length,topCandidates:d.needsReview.slice(0,5).map(p=>({type:p.type,text:p.data.text||`${p.data.source} → ${p.data.target}`,confidence:p.data.confidence,reason:p.reason}))},newNodes:g,newLinks:m,message:`📊 통합 처리 완료!
🧠 온톨로지: ${d.autoApproved.length}개 엔티티/관계
📄 페이지 텍스트: ${h.totalPages}개 페이지
🖼️ 페이지 이미지: ${f.totalPages}개 이미지
⏱️ 총 처리시간: ${y}ms`,totalProcessingTime:y})}else if(l&&n==="pages"){const o=await Sr(a,i);return o.pageNodes.forEach(c=>{C.push(c)}),o.pageRelationships.forEach(c=>{N.push({source:c.source,target:c.target,type:c.type,strength:c.strength,evidence:c.evidence})}),e.json({success:!0,processingMode:"pages",processedDocument:{id:o.id,filename:o.filename,title:o.title,totalPages:o.totalPages,mainTopics:o.mainTopics,summary:o.documentSummary},pdfAnalysis:{pages:o.totalPages,pageNodes:o.pageNodes.length,pageRelationships:o.pageRelationships.length,mainTopics:o.mainTopics,processingTime:o.metadata.processingTime},newNodes:o.pageNodes.map(c=>({...c,isNew:!0})),newLinks:o.pageRelationships,message:`PDF 페이지별 분석 완료: ${o.totalPages}개 페이지, ${o.pageRelationships.length}개 관계 생성`})}else if(l&&n==="images"){const o=await Er(a,i);return o.pageImages.forEach(c=>{C.push(c)}),o.pageRelationships.forEach(c=>{N.push({source:c.source,target:c.target,type:c.type,strength:c.strength,evidence:c.evidence})}),e.json({success:!0,processingMode:"images",processedDocument:{id:o.id,filename:o.filename,title:o.title,totalPages:o.totalPages,mainTopics:o.mainTopics,summary:o.documentSummary},pdfImageAnalysis:{pages:o.totalPages,pageImages:o.pageImages.length,pageRelationships:o.pageRelationships.length,mainTopics:o.mainTopics,processingTime:o.metadata.processingTime},newNodes:o.pageImages.map(c=>({...c,isNew:!0})),newLinks:o.pageRelationships,message:`PDF 이미지 변환 완료: ${o.totalPages}개 페이지 이미지, ${o.pageRelationships.length}개 관계 생성`})}else{const o=await Rr(a,s),c=await Pr(o),d=[],h=[];return c.autoApproved.forEach(f=>{if(f.type==="entity"){const g={id:f.data.id,label:f.data.text,type:f.data.type,category:f.data.category,x:Math.random()*400-200,y:Math.random()*400-200,z:Math.random()*200-100,color:Ar(f.data.type),isNew:!0,confidence:f.data.confidence,source:o.id};C.push(g),d.push(g)}else if(f.type==="relationship"){const g={source:f.data.source,target:f.data.target,type:f.data.type,strength:f.data.confidence,evidence:f.data.evidence,source_doc:o.id};N.push(g),h.push(g)}}),e.json({success:!0,processingMode:"ontology",processedDocument:{id:o.id,filename:o.filename,confidence:o.confidence,documentType:o.metadata.documentType,client:o.metadata.client,tags:o.metadata.tags},autoApproved:{entities:c.autoApproved.filter(f=>f.type==="entity").length,relationships:c.autoApproved.filter(f=>f.type==="relationship").length},needsReview:{count:c.needsReview.length,topCandidates:c.needsReview.slice(0,5).map(f=>({type:f.type,text:f.data.text||`${f.data.source} → ${f.data.target}`,confidence:f.data.confidence,reason:f.reason}))},newNodes:d,newLinks:h,message:`문서 처리 완료: ${c.autoApproved.length}개 자동 승인, ${c.needsReview.length}개 검토 필요`})}}catch{return e.json({success:!1,error:"문서 처리 중 오류 발생"},500)}});j.get("/api/pdf/page/:pageId",e=>{const t=e.req.param("pageId"),r=C.find(a=>a.id===t&&a.type==="pdf_page");return r?e.json({page:r,relatedPages:N.filter(a=>a.source===t||a.target===t).map(a=>({relationshipType:a.type,relatedPageId:a.source===t?a.target:a.source,strength:a.strength,evidence:a.evidence}))}):e.json({error:"페이지를 찾을 수 없습니다"},404)});j.get("/api/pdf/document/:docId/pages",e=>{const t=e.req.param("docId"),r=C.filter(a=>a.type==="pdf_page"&&a.documentId===t).sort((a,s)=>a.pageNumber-s.pageNumber);return e.json({documentId:t,totalPages:r.length,pages:r.map(a=>{var s,i;return{id:a.id,pageNumber:a.pageNumber,title:a.title,summary:a.summary,keywords:a.keywords,wordCount:a.wordCount,imageCount:((s=a.images)==null?void 0:s.length)||0,tableCount:((i=a.tables)==null?void 0:i.length)||0}})})});j.get("/api/review/pending",e=>{const t=[{id:"review-1",type:"entity",text:"Quantum Computing",confidence:.65,context:"차세대 컴퓨팅 기술인 Quantum Computing을 활용한...",suggestedType:"technology",reason:"새로운 기술 용어, 확신도 검증 필요"},{id:"review-2",type:"relationship",text:"AI → 자동화율",confidence:.58,evidence:"AI 도입으로 자동화율이 90% 향상되었다",suggestedType:"improves",reason:"관계 강도 불분명"}];return e.json(t)});j.post("/api/review/:id/decision",async e=>{const t=e.req.param("id"),{decision:r,feedback:a}=await e.req.json();return e.json({success:!0,reviewId:t,decision:r,feedback:a,message:r==="approve"?"승인되어 온톨로지에 추가되었습니다":"거절되었습니다",learningUpdate:"피드백이 학습 모델에 반영되어 다음 처리 정확도가 향상됩니다"})});function Ar(e){return{organization:"#e74c3c",division:"#c0392b",practice:"#e67e22",industry:"#3498db",client:"#2980b9",capability:"#2ecc71",technology:"#9b59b6",deliverable:"#f39c12",kpi:"#1abc9c",document:"#95a5a6",pdf_page_image:"#ffffff",ai_keyword:"#e74c3c",consulting_insight:"#f39c12",pdf_page:"#3498db"}[e]||"#34495e"}async function Rr(e,t){return{id:`doc-${Date.now()}`,filename:e,title:"삼성DS S&OP 최적화 프로젝트",confidence:.87,metadata:{documentType:"proposal",client:"samsung",tags:["digital","ai","supply-chain"],uploadTime:new Date().toISOString()},extractedEntities:[{id:"extracted-entity-1",text:"Quantum Computing",type:"technology",category:"discovered",confidence:.65},{id:"extracted-entity-2",text:"Edge Computing",type:"technology",category:"discovered",confidence:.82}],extractedRelationships:[{id:"extracted-rel-1",source:"samsung",target:"extracted-entity-2",type:"adopts",confidence:.78,evidence:"삼성은 Edge Computing 기술을 적극 도입하고 있다"}]}}async function Er(e,t){const r=Date.now(),a=[{id:`page-img-${Date.now()}-1`,documentId:`pdf-doc-${Date.now()}`,pageNumber:1,imageDataUrl:Ne(1),width:1920,height:1080,aspectRatio:1920/1080,type:"pdf_page_image",category:"document_page_image",x:Math.cos(0)*400,y:Math.sin(0)*400,z:0,color:"#ffffff",label:"제안서 표지",pageTitle:"삼성전자 DX SCM 생성형 AI 제안서",isNew:!0,metadata:{pageNumber:1,title:"삼성전자 DX SCM 생성형 AI 기반 SCM 데이터 조회 MVP 구축",extractedText:"삼성전자 DX SCM 생성형 AI 기반 SCM 데이터 조회 MVP 구축 Workflow 기반 활용 방안 수립",wordCount:32,hasTitle:!0,hasImages:!0,hasTables:!1,hasCharts:!1,pageType:"cover",keywords:["삼성전자","DX","SCM","생성형 AI","MVP","Workflow","PwC"],summary:"PwC의 삼성전자 DX SCM 생성형 AI 기반 데이터 조회 서비스 PoC 제안서 표지",aiKeywords:["Generative AI","SCM","Data Analytics","Digital Transformation"],consultingInsights:["PoC 구축","업무 프로세스 최적화","AI 도입 전략","사용성 제고"],fonts:[{family:"Arial",sizes:[24,36,48],usage:1}],colors:[{hex:"#0066cc",rgb:[0,102,204],usage:.4,role:"primary"},{hex:"#2c3e50",rgb:[44,62,80],usage:.4,role:"text"},{hex:"#ffffff",rgb:[255,255,255],usage:.2,role:"background"}],textBlocks:[],images:[{id:"img-1-1",type:"logo",description:"PwC 로고"}],confidence:.98}},{id:`page-img-${Date.now()}-2`,documentId:`pdf-doc-${Date.now()}`,pageNumber:2,imageDataUrl:Ne(2),width:1920,height:1080,aspectRatio:1920/1080,type:"pdf_page_image",category:"document_page_image",x:Math.cos(1/5*2*Math.PI)*400,y:Math.sin(1/5*2*Math.PI)*400,z:20,color:"#ffffff",label:"Agenda",pageTitle:"Agenda",isNew:!0,metadata:{pageNumber:2,title:"Agenda",extractedText:"I. 제안 개요 II. 수행 범위 III. 사업 관리 IV. 제안사 소개",wordCount:18,hasTitle:!0,hasImages:!1,hasTables:!1,hasCharts:!1,pageType:"agenda",keywords:["제안개요","수행범위","사업관리","제안사소개","Agenda"],summary:"제안서의 전체 구성과 진행 순서를 나타내는 아젠다 페이지",aiKeywords:["Project Scope","Service Delivery","Implementation"],consultingInsights:["프로젝트 구조화","단계별 접근법","체계적 제안"],fonts:[{family:"Arial",sizes:[16,24,36],usage:1}],colors:[{hex:"#0066cc",rgb:[0,102,204],usage:.4,role:"accent"},{hex:"#2c3e50",rgb:[44,62,80],usage:.5,role:"text"}],confidence:.95}},{id:`page-img-${Date.now()}-3`,documentId:`pdf-doc-${Date.now()}`,pageNumber:3,imageDataUrl:Ne(3),width:1920,height:1080,aspectRatio:1920/1080,type:"pdf_page_image",category:"document_page_image",x:Math.cos(2/5*2*Math.PI)*400,y:Math.sin(2/5*2*Math.PI)*400,z:40,color:"#ffffff",label:"프로젝트 추진 목표",pageTitle:"I. 제안 개요 - 프로젝트 추진 목표",isNew:!0,metadata:{pageNumber:3,title:"Gen AI 기반 내/외부 데이터 활용 추진 방향성",extractedText:"Gen AI 기반 내/외부 데이터의 업무 활용을 극대화하여 NSCM 시스템의 사용성 제고를 목표로 함. SCM 통합 AI Orchestrator를 통한 Multi Agent 시스템 구축",wordCount:62,hasTitle:!0,hasImages:!0,hasTables:!1,hasCharts:!0,pageType:"strategy",keywords:["Gen AI","NSCM","AI Orchestrator","Multi Agent","SCM","데이터 활용"],summary:"생성형 AI를 활용한 SCM 데이터 조회 서비스의 핵심 목표와 추진 방향성",aiKeywords:["Generative AI","Multi-Agent System","AI Orchestration","Natural Language Processing"],consultingInsights:["시스템 통합 전략","AI 활용 극대화","사용성 중심 설계","업무 효율성 향상"],fonts:[{family:"Arial",sizes:[16,24,36],usage:1}],colors:[{hex:"#2ecc71",rgb:[46,204,113],usage:.3,role:"accent"},{hex:"#3498db",rgb:[52,152,219],usage:.3,role:"primary"},{hex:"#9b59b6",rgb:[155,89,182],usage:.2,role:"accent"}],confidence:.97}},{id:`page-img-${Date.now()}-4`,documentId:`pdf-doc-${Date.now()}`,pageNumber:4,imageDataUrl:Ne(4),width:1920,height:1080,aspectRatio:1920/1080,type:"pdf_page_image",category:"document_page_image",x:Math.cos(3/5*2*Math.PI)*400,y:Math.sin(3/5*2*Math.PI)*400,z:60,color:"#ffffff",label:"구현 계획",pageTitle:"구현 계획",isNew:!0,metadata:{pageNumber:4,title:"구현 계획",extractedText:"3. 구현 계획 Phase 1 데이터 플랫폼 Phase 2 AI 모델 Phase 3 전사 적용",wordCount:52,hasTitle:!0,hasImages:!1,hasTables:!0,hasCharts:!1,pageType:"content",keywords:["구현계획","Phase","데이터플랫폼","AI모델","전사적용"],summary:"3단계 Phase별 구현 계획 및 일정",fonts:[{family:"Arial",sizes:[14,16,24],usage:1}],colors:[{hex:"#f39c12",rgb:[243,156,18],usage:.4,role:"accent"}],confidence:.9}},{id:`page-img-${Date.now()}-5`,documentId:`pdf-doc-${Date.now()}`,pageNumber:5,imageDataUrl:Ne(5),width:1920,height:1080,aspectRatio:1920/1080,type:"pdf_page_image",category:"document_page_image",x:Math.cos(4/5*2*Math.PI)*400,y:Math.sin(4/5*2*Math.PI)*400,z:80,color:"#ffffff",label:"기대 효과",pageTitle:"기대 효과",isNew:!0,metadata:{pageNumber:5,title:"기대 효과 및 ROI",extractedText:"4. 기대 효과 ROI 150% 연간 50억원 절감 1년차 120% 2년차 180%",wordCount:42,hasTitle:!0,hasImages:!0,hasTables:!0,hasCharts:!0,pageType:"chart",keywords:["ROI","150%","50억원","절감","기대효과"],summary:"ROI 150% 달성과 연간 50억원 절감 효과 분석",fonts:[{family:"Arial",sizes:[16,24,36],usage:1}],colors:[{hex:"#e74c3c",rgb:[231,76,60],usage:.3,role:"accent"},{hex:"#f39c12",rgb:[243,156,18],usage:.2,role:"accent"},{hex:"#2ecc71",rgb:[46,204,113],usage:.2,role:"accent"}],confidence:.96}}],s=[],i=[];a.forEach((c,d)=>{var f,g;const h=700+d*100;(f=c.metadata.aiKeywords)==null||f.forEach((m,y)=>{const p=(d*2+y*.5)*Math.PI/3;s.push({id:`ai-keyword-${Date.now()}-${d}-${y}`,label:m,type:"ai_keyword",category:"ai_concept",x:Math.cos(p)*h,y:Math.sin(p)*h,z:200+y*40,color:"#e74c3c",size:8,isNew:!0,sourcePageId:c.id,confidence:.9+Math.random()*.1,metadata:{keyword:m,category:"AI Technology",relevance:"High",extractedFrom:c.metadata.title}})}),(g=c.metadata.consultingInsights)==null||g.forEach((m,y)=>{const p=(d*2+y*.7+Math.PI)*Math.PI/3;i.push({id:`consulting-${Date.now()}-${d}-${y}`,label:m,type:"consulting_insight",category:"business_insight",x:Math.cos(p)*(h+160),y:Math.sin(p)*(h+160),z:160+y*50,color:"#f39c12",size:10,isNew:!0,sourcePageId:c.id,confidence:.85+Math.random()*.1,metadata:{insight:m,category:"Business Strategy",impact:"Medium",extractedFrom:c.metadata.title}})})});const n=[...a,...s,...i],l=[];for(let c=0;c<a.length-1;c++)l.push({source:a[c].id,target:a[c+1].id,type:"next_page",strength:1,evidence:"순차적 페이지"});s.forEach(c=>{l.push({source:c.sourcePageId,target:c.id,type:"contains_ai_concept",strength:.8,evidence:"AI 개념 추출"})}),i.forEach(c=>{l.push({source:c.sourcePageId,target:c.id,type:"generates_insight",strength:.7,evidence:"컨설팅 인사이트 도출"})}),a.length>=3&&l.push({source:a[1].id,target:a[2].id,type:"leads_to",strength:.9,evidence:"아젠다 → 제안 개요 연결"});const o=Date.now()-r;return{id:`pdf-doc-${Date.now()}`,filename:e,title:e.replace(".pdf",""),totalPages:a.length,pageImages:n,pageRelationships:l,documentSummary:`삼성전자 DX SCM 생성형 AI 제안서: ${a.length}개 페이지, ${s.length}개 AI 키워드, ${i.length}개 컨설팅 인사이트`,mainTopics:["Gen AI","SCM","Multi Agent","NSCM","AI Orchestrator","Digital Transformation"],aiKeywordCount:s.length,consultingInsightCount:i.length,metadata:{fileSize:t,processingTime:o,createdDate:new Date().toISOString(),aiKeywordCount:s.length,consultingInsightCount:i.length}}}function Ne(e){const t={1:`data:image/svg+xml;charset=utf-8,${encodeURIComponent(`
      <svg width="400" height="300" xmlns="http://www.w3.org/2000/svg">
        <rect width="400" height="300" fill="white" stroke="#ddd" stroke-width="2"/>
        <rect x="20" y="20" width="60" height="25" fill="#0066cc"/>
        <text x="50" y="37" fill="white" font-family="Arial" font-size="11" text-anchor="middle" font-weight="bold">PwC</text>
        <rect x="320" y="20" width="60" height="25" fill="#1f4e79"/>
        <text x="350" y="37" fill="white" font-family="Arial" font-size="8" text-anchor="middle">삼성전자</text>
        <text x="200" y="80" fill="#0066cc" font-family="Arial" font-size="14" text-anchor="middle" font-weight="bold">추가 Proposal</text>
        <text x="200" y="130" fill="#2c3e50" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold">삼성전자 DX SCM</text>
        <text x="200" y="150" fill="#2c3e50" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold">생성형 AI 기반 SCM 데이터 조회</text>
        <text x="200" y="170" fill="#2c3e50" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold">MVP 구축 Workflow</text>
        <text x="200" y="210" fill="#e74c3c" font-family="Arial" font-size="10" text-anchor="middle">Confidential</text>
        <text x="200" y="260" fill="#7f8c8d" font-family="Arial" font-size="12" text-anchor="middle">2025.2</text>
      </svg>
    `)}`,2:`data:image/svg+xml;charset=utf-8,${encodeURIComponent(`
      <svg width="400" height="300" xmlns="http://www.w3.org/2000/svg">
        <rect width="400" height="300" fill="white" stroke="#ddd" stroke-width="2"/>
        <text x="200" y="40" fill="#0066cc" font-family="Arial" font-size="18" text-anchor="middle" font-weight="bold">Agenda</text>
        <line x1="50" y1="60" x2="350" y2="60" stroke="#0066cc" stroke-width="2"/>
        <circle cx="30" cy="90" r="4" fill="#2c3e50"/>
        <text x="50" y="95" fill="#2c3e50" font-family="Arial" font-size="14" font-weight="bold">I. 제안 개요</text>
        <circle cx="30" cy="130" r="4" fill="#2c3e50"/>
        <text x="50" y="135" fill="#2c3e50" font-family="Arial" font-size="14" font-weight="bold">II. 수행 범위</text>
        <circle cx="30" cy="170" r="4" fill="#2c3e50"/>
        <text x="50" y="175" fill="#2c3e50" font-family="Arial" font-size="14" font-weight="bold">III. 사업 관리</text>
        <circle cx="30" cy="210" r="4" fill="#2c3e50"/>
        <text x="50" y="215" fill="#2c3e50" font-family="Arial" font-size="14" font-weight="bold">IV. 제안사 소개</text>
        <rect x="300" y="250" width="80" height="30" fill="#0066cc" opacity="0.1"/>
        <text x="340" y="270" fill="#0066cc" font-family="Arial" font-size="10" text-anchor="middle">Structure</text>
      </svg>
    `)}`,3:`data:image/svg+xml;charset=utf-8,${encodeURIComponent(`
      <svg width="400" height="300" xmlns="http://www.w3.org/2000/svg">
        <rect width="400" height="300" fill="white" stroke="#ddd" stroke-width="2"/>
        <text x="20" y="30" fill="#0066cc" font-family="Arial" font-size="12" font-weight="bold">I. 제안 개요</text>
        <text x="20" y="50" fill="#2c3e50" font-family="Arial" font-size="14" font-weight="bold">프로젝트 추진 목표</text>
        <rect x="20" y="60" width="360" height="50" fill="#e8f4f8" stroke="#0066cc" stroke-width="1"/>
        <text x="200" y="80" fill="#2c3e50" font-family="Arial" font-size="10" text-anchor="middle">Gen AI 기반 내/외부 데이터의 업무 활용을 극대화하여</text>
        <text x="200" y="95" fill="#2c3e50" font-family="Arial" font-size="10" text-anchor="middle">NSCM 시스템의 사용성 제고를 목표로 함</text>
        <rect x="50" y="130" width="80" height="40" fill="#2ecc71" rx="5"/>
        <text x="90" y="145" fill="white" font-family="Arial" font-size="8" text-anchor="middle">내부 정형</text>
        <text x="90" y="157" fill="white" font-family="Arial" font-size="8" text-anchor="middle">Data Agent</text>
        <rect x="160" y="130" width="80" height="40" fill="#e74c3c" rx="5"/>
        <text x="200" y="145" fill="white" font-family="Arial" font-size="8" text-anchor="middle">외부 비정형</text>
        <text x="200" y="157" fill="white" font-family="Arial" font-size="8" text-anchor="middle">Data Agent</text>
        <rect x="270" y="130" width="80" height="40" fill="#9b59b6" rx="5"/>
        <text x="310" y="145" fill="white" font-family="Arial" font-size="8" text-anchor="middle">SCM Workflow</text>
        <text x="310" y="157" fill="white" font-family="Arial" font-size="8" text-anchor="middle">업무 Agent</text>
        <rect x="120" y="200" width="160" height="30" fill="#f39c12" rx="5"/>
        <text x="200" y="218" fill="white" font-family="Arial" font-size="10" text-anchor="middle" font-weight="bold">SCM 통합 AI Orchestrator</text>
        <text x="200" y="250" fill="#7f8c8d" font-family="Arial" font-size="8" text-anchor="middle">Multi Agent System</text>
      </svg>
    `)}`,4:`data:image/svg+xml;charset=utf-8,${encodeURIComponent(`
      <svg width="400" height="300" xmlns="http://www.w3.org/2000/svg">
        <rect width="400" height="300" fill="white" stroke="#ddd" stroke-width="2"/>
        <text x="20" y="40" fill="#2c3e50" font-family="Arial" font-size="16" font-weight="bold">3. 구현 계획</text>
        <line x1="50" y1="120" x2="350" y2="120" stroke="#f39c12" stroke-width="3"/>
        <circle cx="100" cy="120" r="8" fill="#f39c12"/>
        <circle cx="200" cy="120" r="8" fill="#f39c12"/>
        <circle cx="300" cy="120" r="8" fill="#f39c12"/>
        <text x="85" y="140" fill="#2c3e50" font-family="Arial" font-size="10">Phase 1</text>
        <text x="185" y="140" fill="#2c3e50" font-family="Arial" font-size="10">Phase 2</text>
        <text x="285" y="140" fill="#2c3e50" font-family="Arial" font-size="10">Phase 3</text>
        <text x="75" y="155" fill="#7f8c8d" font-family="Arial" font-size="8">1-3개월</text>
        <text x="175" y="155" fill="#7f8c8d" font-family="Arial" font-size="8">4-6개월</text>
        <text x="275" y="155" fill="#7f8c8d" font-family="Arial" font-size="8">7-9개월</text>
      </svg>
    `)}`,5:`data:image/svg+xml;charset=utf-8,${encodeURIComponent(`
      <svg width="400" height="300" xmlns="http://www.w3.org/2000/svg">
        <rect width="400" height="300" fill="white" stroke="#ddd" stroke-width="2"/>
        <text x="20" y="40" fill="#2c3e50" font-family="Arial" font-size="16" font-weight="bold">4. 기대 효과</text>
        <rect x="50" y="140" width="40" height="60" fill="#e74c3c"/>
        <rect x="130" y="120" width="40" height="80" fill="#f39c12"/>
        <rect x="210" y="100" width="40" height="100" fill="#2ecc71"/>
        <text x="65" y="215" fill="#2c3e50" font-family="Arial" font-size="10" text-anchor="middle">1년차</text>
        <text x="145" y="215" fill="#2c3e50" font-family="Arial" font-size="10" text-anchor="middle">2년차</text>
        <text x="225" y="215" fill="#2c3e50" font-family="Arial" font-size="10" text-anchor="middle">3년차</text>
        <text x="280" y="80" fill="#2c3e50" font-family="Arial" font-size="14" font-weight="bold">ROI: 150%</text>
        <text x="280" y="100" fill="#2c3e50" font-family="Arial" font-size="12">연간 50억원 절감</text>
      </svg>
    `)}`};return t[e]||t[1]}async function Sr(e,t){const r=Date.now(),a=[{id:`page-${Date.now()}-1`,documentId:`pdf-doc-${Date.now()}`,documentTitle:e.replace(".pdf",""),pageNumber:1,title:"삼성DS 사업부 S&OP 최적화 프로젝트 제안서",content:"Executive Summary 내용...",summary:"삼성 DS 사업부의 S&OP 프로세스 최적화를 통한 운영 효율성 증대 방안 제시",keywords:["삼성","DS","S&OP","최적화","Executive Summary"],images:[{id:"img-1-1",description:"PwC 로고",type:"logo"}],tables:[],type:"pdf_page",category:"document_page",x:Math.cos(0)*200,y:Math.sin(0)*200,z:0,color:"#e74c3c",wordCount:89,confidence:.9},{id:`page-${Date.now()}-2`,documentId:`pdf-doc-${Date.now()}`,documentTitle:e.replace(".pdf",""),pageNumber:2,title:"1. 현황 분석",content:"AS-IS 프로세스 분석 및 벤치마킹...",summary:"현재 S&OP 프로세스의 한계점 분석 및 글로벌 벤치마킹 결과",keywords:["현황분석","AS-IS","벤치마킹","한계점","프로세스"],images:[{id:"img-2-1",description:"AS-IS vs TO-BE 비교 차트",type:"chart"}],tables:[{id:"table-2-1",headers:["구분","AS-IS","TO-BE"],rows:[]}],type:"pdf_page",category:"document_page",x:Math.cos(1/5*2*Math.PI)*200,y:Math.sin(1/5*2*Math.PI)*200,z:20,color:"#3498db",wordCount:156,confidence:.9},{id:`page-${Date.now()}-3`,documentId:`pdf-doc-${Date.now()}`,documentTitle:e.replace(".pdf",""),pageNumber:3,title:"2. 제안 솔루션",content:"AI 기반 수요 예측 모델 및 Palantir 플랫폼...",summary:"AI 기반 수요 예측과 Palantir Foundry를 활용한 통합 플랫폼 솔루션",keywords:["AI","예측모델","Palantir","Foundry","솔루션"],images:[{id:"img-3-1",description:"AI 모델 아키텍처",type:"diagram"}],tables:[],type:"pdf_page",category:"document_page",x:Math.cos(2/5*2*Math.PI)*200,y:Math.sin(2/5*2*Math.PI)*200,z:40,color:"#2ecc71",wordCount:134,confidence:.9},{id:`page-${Date.now()}-4`,documentId:`pdf-doc-${Date.now()}`,documentTitle:e.replace(".pdf",""),pageNumber:4,title:"3. 구현 계획 및 일정",content:"3단계 Phase별 구현 계획...",summary:"데이터 플랫폼 구축부터 전사 적용까지 3단계 구현 로드맵",keywords:["구현계획","Phase","일정","로드맵","적용"],images:[],tables:[{id:"table-4-1",headers:["Phase","기간","주요활동"],rows:[]}],type:"pdf_page",category:"document_page",x:Math.cos(3/5*2*Math.PI)*200,y:Math.sin(3/5*2*Math.PI)*200,z:60,color:"#f39c12",wordCount:178,confidence:.9},{id:`page-${Date.now()}-5`,documentId:`pdf-doc-${Date.now()}`,documentTitle:e.replace(".pdf",""),pageNumber:5,title:"4. 기대 효과 및 ROI",content:"연간 50억원 비용 절감, ROI 150%...",summary:"정량적/정성적 효과 분석 및 3년간 ROI 150% 달성 계획",keywords:["ROI","비용절감","50억원","150%","기대효과"],images:[{id:"img-5-1",description:"ROI 추이 그래프",type:"chart"}],tables:[{id:"table-5-1",headers:["구분","1년차","2년차","3년차"],rows:[]}],type:"pdf_page",category:"document_page",x:Math.cos(4/5*2*Math.PI)*200,y:Math.sin(4/5*2*Math.PI)*200,z:80,color:"#9b59b6",wordCount:145,confidence:.9}],s=[];for(let n=0;n<a.length-1;n++)s.push({source:a[n].id,target:a[n+1].id,type:"next_page",strength:1,evidence:"순차적 페이지"});s.push({source:a[1].id,target:a[2].id,type:"similar_topic",strength:.8,evidence:"현황 분석 → 솔루션 연결"}),s.push({source:a[2].id,target:a[4].id,type:"similar_topic",strength:.7,evidence:"솔루션 → 효과 연결"});const i=Date.now()-r;return{id:`pdf-doc-${Date.now()}`,filename:e,title:e.replace(".pdf",""),totalPages:a.length,pageNodes:a,pageRelationships:s,documentSummary:`${a.length}페이지 제안서: S&OP 최적화를 통한 연간 50억원 절감 및 ROI 150% 달성 계획`,mainTopics:["S&OP","AI","Palantir","ROI","최적화"],metadata:{fileSize:t,processingTime:i,createdDate:new Date().toISOString()}}}async function Pr(e){const t=e.extractedEntities.filter(s=>s.confidence>=.75).map(s=>({type:"entity",data:s})),r=e.extractedRelationships.filter(s=>s.confidence>=.75).map(s=>({type:"relationship",data:s})),a=[...e.extractedEntities.filter(s=>s.confidence<.75&&s.confidence>=.5),...e.extractedRelationships.filter(s=>s.confidence<.75&&s.confidence>=.5)].map(s=>({type:s.source?"relationship":"entity",data:s,reason:`신뢰도 ${s.confidence.toFixed(2)} - 검토 필요`}));return{autoApproved:[...t,...r],needsReview:a,rejected:[]}}j.get("/",e=>e.render(O("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900",children:O("div",{id:"root"})})));var de=class extends Error{constructor(e,t){super(e,t),this.name="RequestError"}},ui=e=>e instanceof de?e:new de(e.message,{cause:e}),hi=global.Request,Ue=class extends hi{constructor(t,r){var a;typeof t=="object"&&Me in t&&(t=t[Me]()),typeof((a=r==null?void 0:r.body)==null?void 0:a.getReader)<"u"&&(r.duplex??(r.duplex="half")),super(t,r)}},pi=e=>{const t=[],r=e.rawHeaders;for(let a=0;a<r.length;a+=2){const{[a]:s,[a+1]:i}=r;s.charCodeAt(0)!==58&&t.push([s,i])}return new Headers(t)},xa=Symbol("wrapBodyStream"),gi=(e,t,r,a,s)=>{const i={method:e,headers:r,signal:s.signal};if(e==="TRACE"){i.method="GET";const n=new Ue(t,i);return Object.defineProperty(n,"method",{get(){return"TRACE"}}),n}if(!(e==="GET"||e==="HEAD"))if("rawBody"in a&&a.rawBody instanceof Buffer)i.body=new ReadableStream({start(n){n.enqueue(a.rawBody),n.close()}});else if(a[xa]){let n;i.body=new ReadableStream({async pull(l){try{n||(n=ar.toWeb(a).getReader());const{done:o,value:c}=await n.read();o?l.close():l.enqueue(c)}catch(o){l.error(o)}}})}else i.body=ar.toWeb(a);return new Ue(t,i)},Me=Symbol("getRequestCache"),$t=Symbol("requestCache"),gt=Symbol("incomingKey"),wt=Symbol("urlKey"),Dt=Symbol("headersKey"),Q=Symbol("abortControllerKey"),yi=Symbol("getAbortController"),bt={get method(){return this[gt].method||"GET"},get url(){return this[wt]},get headers(){return this[Dt]||(this[Dt]=pi(this[gt]))},[yi](){return this[Me](),this[Q]},[Me](){return this[Q]||(this[Q]=new AbortController),this[$t]||(this[$t]=gi(this.method,this[wt],this.headers,this[gt],this[Q]))}};["body","bodyUsed","cache","credentials","destination","integrity","mode","redirect","referrer","referrerPolicy","signal","keepalive"].forEach(e=>{Object.defineProperty(bt,e,{get(){return this[Me]()[e]}})});["arrayBuffer","blob","clone","formData","json","text"].forEach(e=>{Object.defineProperty(bt,e,{value:function(){return this[Me]()[e]()}})});Object.setPrototypeOf(bt,Ue.prototype);var mi=(e,t)=>{const r=Object.create(bt);r[gt]=e;const a=e.url||"";if(a[0]!=="/"&&(a.startsWith("http://")||a.startsWith("https://"))){if(e instanceof nt)throw new de("Absolute URL for :path is not allowed in HTTP/2");try{const l=new URL(a);r[wt]=l.href}catch(l){throw new de("Invalid absolute URL",{cause:l})}return r}const s=(e instanceof nt?e.authority:e.headers.host)||t;if(!s)throw new de("Missing host header");let i;if(e instanceof nt){if(i=e.scheme,!(i==="http"||i==="https"))throw new de("Unsupported scheme")}else i=e.socket&&e.socket.encrypted?"https":"http";const n=new URL(`${i}://${s}${a}`);if(n.hostname.length!==s.length&&n.hostname!==s.replace(/:\d+$/,""))throw new de("Invalid host header");return r[wt]=n.href,r},it=Symbol("responseCache"),Re=Symbol("getResponseCache"),fe=Symbol("cache"),Jt=global.Response,Ze,Z,Te,rt=(Te=class{constructor(t,r){b(this,Ze);b(this,Z);let a;if(x(this,Ze,t),r instanceof Te){const s=r[it];if(s){x(this,Z,s),this[Re]();return}else x(this,Z,u(r,Z)),a=new Headers(u(r,Z).headers)}else x(this,Z,r);(typeof t=="string"||typeof(t==null?void 0:t.getReader)<"u"||t instanceof Blob||t instanceof Uint8Array)&&(a||(a=(r==null?void 0:r.headers)||{"content-type":"text/plain; charset=UTF-8"}),this[fe]=[(r==null?void 0:r.status)||200,t,a])}[Re](){return delete this[fe],this[it]||(this[it]=new Jt(u(this,Ze),u(this,Z)))}get headers(){const t=this[fe];return t?(t[2]instanceof Headers||(t[2]=new Headers(t[2])),t[2]):this[Re]().headers}get status(){var t;return((t=this[fe])==null?void 0:t[0])??this[Re]().status}get ok(){const t=this.status;return t>=200&&t<300}},Ze=new WeakMap,Z=new WeakMap,Te);["body","bodyUsed","redirected","statusText","trailers","type","url"].forEach(e=>{Object.defineProperty(rt.prototype,e,{get(){return this[Re]()[e]}})});["arrayBuffer","blob","clone","formData","json","text"].forEach(e=>{Object.defineProperty(rt.prototype,e,{value:function(){return this[Re]()[e]()}})});Object.setPrototypeOf(rt,Jt);Object.setPrototypeOf(rt.prototype,Jt.prototype);async function vi(e){return Promise.race([e,Promise.resolve().then(()=>Promise.resolve(void 0))])}function ba(e,t,r){const a=()=>{};return t.on("error",a),(r??e.read()).then(n,s),e.closed.finally(()=>{t.off("error",a)});function s(l){l&&t.destroy(l)}function i(){e.read().then(n,s)}function n({done:l,value:o}){try{if(l)t.end();else if(!t.write(o))t.once("drain",i);else return e.read().then(n,s)}catch(c){s(c)}}}function wi(e,t){if(e.locked)throw new TypeError("ReadableStream is locked.");return t.destroyed?void 0:ba(e.getReader(),t)}var Aa=e=>{const t={};e instanceof Headers||(e=new Headers(e??void 0));const r=[];for(const[a,s]of e)a==="set-cookie"?r.push(s):t[a]=s;return r.length>0&&(t["set-cookie"]=r),t["content-type"]??(t["content-type"]="text/plain; charset=UTF-8"),t},xi="x-hono-already-sent",bi=global.fetch;typeof global.crypto>"u"&&(global.crypto=ja);global.fetch=(e,t)=>(t={compress:!1,...t},bi(e,t));var Yt=Symbol("outgoingEnded"),Ai=()=>new Response(null,{status:400}),Ra=e=>new Response(null,{status:e instanceof Error&&(e.name==="TimeoutError"||e.constructor.name==="TimeoutError")?504:500}),Ut=(e,t)=>{const r=e instanceof Error?e:new Error("unknown error",{cause:e});r.code==="ERR_STREAM_PREMATURE_CLOSE"?console.info("The user aborted a request."):(console.error(e),t.headersSent||t.writeHead(500,{"Content-Type":"text/plain"}),t.end(`Error: ${r.message}`),t.destroy(r))},Ea=e=>{"flushHeaders"in e&&e.writable&&e.flushHeaders()},Sa=async(e,t)=>{var i,n;let[r,a,s]=e[fe];s instanceof Headers&&(s=Aa(s)),typeof a=="string"?s["Content-Length"]=Buffer.byteLength(a):a instanceof Uint8Array?s["Content-Length"]=a.byteLength:a instanceof Blob&&(s["Content-Length"]=a.size),t.writeHead(r,s),typeof a=="string"||a instanceof Uint8Array?t.end(a):a instanceof Blob?t.end(new Uint8Array(await a.arrayBuffer())):(Ea(t),await((i=wi(a,t))==null?void 0:i.catch(l=>Ut(l,t)))),(n=t[Yt])==null||n.call(t)},Ri=async(e,t,r={})=>{var s;if(e instanceof Promise)if(r.errorHandler)try{e=await e}catch(i){const n=await r.errorHandler(i);if(!n)return;e=n}else e=await e.catch(Ra);if(fe in e)return Sa(e,t);const a=Aa(e.headers);if(e.body){const i=e.body.getReader(),n=[];let l=!1,o;if(a["transfer-encoding"]!=="chunked"){let c=2;for(let d=0;d<c;d++){o||(o=i.read());const h=await vi(o).catch(f=>{console.error(f),l=!0});if(!h){if(d===1){await new Promise(f=>setTimeout(f)),c=3;continue}break}if(o=void 0,h.value&&n.push(h.value),h.done){l=!0;break}}l&&!("content-length"in a)&&(a["content-length"]=n.reduce((d,h)=>d+h.length,0))}t.writeHead(e.status,a),n.forEach(c=>{t.write(c)}),l?t.end():(n.length===0&&Ea(t),await ba(i,t,o))}else a[xi]||(t.writeHead(e.status,a),t.end());(s=t[Yt])==null||s.call(t)},Ei=(e,t={})=>{const r=t.autoCleanupIncoming??!0;return t.overrideGlobalObjects!==!1&&global.Request!==Ue&&(Object.defineProperty(global,"Request",{value:Ue}),Object.defineProperty(global,"Response",{value:rt})),async(a,s)=>{let i,n;try{n=mi(a,t.hostname);let l=!r||a.method==="GET"||a.method==="HEAD";if(l||(a[xa]=!0,a.on("end",()=>{l=!0}),a instanceof nt&&(s[Yt]=()=>{l||setTimeout(()=>{l||setTimeout(()=>{a.destroy(),s.destroy()})})})),s.on("close",()=>{n[Q]&&(a.errored?n[Q].abort(a.errored.toString()):s.writableFinished||n[Q].abort("Client connection prematurely closed.")),l||setTimeout(()=>{l||setTimeout(()=>{a.destroy()})})}),i=e(n,{incoming:a,outgoing:s}),fe in i)return Sa(i,s)}catch(l){if(i)return Ut(l,s);if(t.errorHandler){if(i=await t.errorHandler(n?l:ui(l)),!i)return}else n?i=Ra(l):i=Ai()}try{return await Ri(i,s,t)}catch(l){return Ut(l,s)}}},Si=e=>{const t=e.fetch,r=Ei(t,{hostname:e.hostname,overrideGlobalObjects:e.overrideGlobalObjects,autoCleanupIncoming:e.autoCleanupIncoming});return(e.createServer||Ma)(e.serverOptions||{},r)},Pi=(e,t)=>{const r=Si(e);return r.listen(e==null?void 0:e.port,e.hostname,()=>{r.address()}),r};const me=new da;me.use("/favicon.ico",et({root:"./"}));me.use("/static/*",et({root:"./"}));me.use("/_routes.json",et({root:"./"}));me.use("/_worker.js",et({root:"./"}));const Ci=Object.assign({"/src/index.tsx":j});let Pa=!1;for(const[,e]of Object.entries(Ci))e&&(me.all("*",t=>{let r;try{r=t.executionCtx}catch{}return e.fetch(t.req.raw,t.env,r)}),me.notFound(t=>{let r;try{r=t.executionCtx}catch{}return e.fetch(t.req.raw,t.env,r)}),Pa=!0);if(!Pa)throw new Error("Can't import modules from ['/src/index.tsx']");Pi({fetch:me.fetch,port:3e3});export{me as default};
